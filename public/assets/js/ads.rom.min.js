function hideEmulatorContextMenu(){function e(){$(".ejs_menu_button").each(function(){const e=$(this);"Context Menu"===e.find(".ejs_menu_text").text().trim()&&e.hide()}),$(".ejs_context_menu").css("display","none"),$("#emulatorjs-container, #emulatorjs-game, canvas").off("contextmenu.emulator").on("contextmenu.emulator",function(e){return e.preventDefault(),e.stopPropagation(),!1})}e();setInterval(()=>{$(".ejs_menu_button").length>0&&e()},1e3);if(window.MutationObserver){new MutationObserver(function(t){t.forEach(function(t){t.addedNodes.length&&t.addedNodes.forEach(function(t){if(1===t.nodeType){const n=$(t);(n.hasClass("ejs_menu_button")||n.find(".ejs_menu_button").length>0)&&setTimeout(e,100),(n.is("canvas")||n.hasClass("ejs_")||n.find("canvas").length>0)&&setTimeout(()=>{n.find('canvas, [class*="ejs_"]').addBack().off("contextmenu.emulator").on("contextmenu.emulator",function(e){return e.preventDefault(),e.stopPropagation(),!1})},100)}})})}).observe(document.body,{childList:!0,subtree:!0})}$(document).off("contextmenu.emulatorGlobal").on("contextmenu.emulatorGlobal",function(e){const t=$(e.target);if(t.closest("#emulatorjs-container, #emulatorjs-game").length>0||t.is("canvas")||t.hasClass("ejs_context_menu")||t.closest(".ejs_context_menu").length>0)return e.preventDefault(),e.stopPropagation(),!1})}function configureEmulatorAds(){$.ajax({url:"/requests/banner-ad?width=400&height=300&placement=rom-preroll",method:"GET",dataType:"json",success:function(e){200===e.status&&e.data&&e.data.ad_code&&(window.EJS_AdUrl=`/ads/emulator/rom-preroll/${window.gameData.id}`,window.EJS_AdTimer=8e3,window.EJS_AdMode=1,window.EJS_AdSize=["400px","300px"])}})}window.ROMAdManager={isPlaying:!1,lastAdTime:0,adCooldown:18e4,adContainer:null,init:function(){this.createAdContainer(),this.setupEventListeners()},createAdContainer:function(){const e=$("#emulatorjs-container");this.adContainer=$('\n            <div id="rom-ad-overlay" class="\n                absolute inset-0 w-full h-full \n                bg-black/80 dark:bg-black/90 backdrop-blur-sm\n                hidden z-50 flex items-center justify-center flex-col\n                transition-all duration-300 ease-in-out\n            ">\n                <div id="rom-ad-content" class="\n                    bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100\n                    rounded-xl shadow-2xl p-4 text-center relative\n                    inline-block max-w-4xl max-h-96\n                    border border-gray-200 dark:border-gray-700 backdrop-blur-lg\n                    transform scale-95 transition-transform duration-300\n                    overflow-hidden\n                ">\n                    <button id="rom-ad-close" class="\n                        absolute top-2 right-2 w-8 h-8\n                        bg-gray-900 dark:bg-gray-700 hover:bg-red-600 dark:hover:bg-red-500 \n                        text-white border-2 border-white dark:border-gray-300 \n                        rounded-full cursor-pointer text-sm leading-none z-10\n                        flex items-center justify-center\n                        transition-all duration-200 hover:scale-110\n                        shadow-lg hover:shadow-xl\n                    ">&times;</button>\n                </div>\n            </div>\n        '),e.length?e.css("position","relative").append(this.adContainer):$("body").append(this.adContainer),$("#rom-ad-close").on("click",()=>{this.hideAd()})},setupEventListeners:function(){$(document).on("pjax:send",()=>{this.destroy()}),window.EJS_emulator&&(window.EJS_emulator.on("ready",()=>{this.isPlaying=!0}),window.EJS_emulator.on("pause",()=>{this.isPlaying=!1}),window.EJS_emulator.on("play",()=>{this.isPlaying=!0})),$(window).on("focus",()=>{window.EJS_emulator&&(this.isPlaying=!0)}),$(window).on("blur",()=>{this.isPlaying=!1}),window.triggerROMInterstitial=()=>{this.showInterstitialAd()}},showInterstitialAd:async function(){const e=Date.now();if(!(e-this.lastAdTime<this.adCooldown)&&this.isPlaying)try{const t=await this.fetchAd("rom-interstitial");t&&(this.lastAdTime=e,this.displayAd(t,8e3))}catch(e){}},fetchAd:async function(e){const t=await $.ajax({url:`/requests/banner-ad?width=400&height=300&placement=${e}`,method:"GET",dataType:"json"});return 200===t.status&&t.data&&t.data.ad_code?t.data:null},displayAd:function(e,t=8e3){window.EJS_emulator&&"function"==typeof window.EJS_emulator.pause&&window.EJS_emulator.pause(),$("#rom-ad-content").html(`\n            <button id="rom-ad-close" class="\n                absolute top-2 right-2 w-8 h-8\n                bg-gray-900 dark:bg-gray-700 hover:bg-red-600 dark:hover:bg-red-500 \n                text-white border-2 border-white dark:border-gray-300 \n                rounded-full cursor-pointer text-sm leading-none z-10\n                flex items-center justify-center\n                transition-all duration-200 hover:scale-110\n                shadow-lg hover:shadow-xl\n            ">&times;</button>\n            <div class="ad-content-wrapper max-w-full max-h-full flex items-center justify-center text-gray-900 dark:text-gray-100">\n                ${e.ad_code}\n            </div>\n        `),$("#rom-ad-content").find("img").css({"max-width":"none","max-height":"none",width:"auto",height:"auto","object-fit":"none"}),$("#rom-ad-content").find("iframe, video, embed, object").css({"max-width":"100%","max-height":"100%",width:"auto",height:"auto","object-fit":"contain"}),this.adContainer.removeClass("hidden").addClass("flex"),setTimeout(()=>{$("#rom-ad-content").removeClass("scale-95").addClass("scale-100")},50);const n=setTimeout(()=>{this.hideAd()},t);$("#rom-ad-close").off("click").on("click",()=>{clearTimeout(n),this.hideAd()})},hideAd:function(){$("#rom-ad-content").removeClass("scale-100").addClass("scale-95"),setTimeout(()=>{this.adContainer.removeClass("flex").addClass("hidden"),window.EJS_emulator&&"function"==typeof window.EJS_emulator.play&&this.isPlaying&&window.EJS_emulator.play()},300)},scheduleInterstitialAd:function(){[6e4,18e4,3e5].forEach(e=>{const t=setTimeout(()=>{this.isPlaying&&window.EJS_emulator&&this.showInterstitialAd()},e);this.timers||(this.timers=[]),this.timers.push(t)});const e=setTimeout(()=>{const e=setInterval(()=>{this.isPlaying&&window.EJS_emulator?this.showInterstitialAd():window.EJS_emulator||clearInterval(e)},24e4);this.recurringInterval=e},12e4);this.timers||(this.timers=[]),this.timers.push(e)},destroy:function(){this.timers&&(this.timers.forEach(e=>clearTimeout(e)),this.timers=[]),this.recurringInterval&&(clearInterval(this.recurringInterval),this.recurringInterval=null),this.adContainer&&this.adContainer.remove(),this.adContainer=null,this.isPlaying=!1}},window.showROMInterstitial=function(){window.ROMAdManager&&"function"==typeof window.ROMAdManager.showInterstitialAd&&window.ROMAdManager.showInterstitialAd()},window.EJS_onGameStart=function(){window.ROMAdManager&&!window.ROMAdManager.adContainer&&window.ROMAdManager.init(),window.ROMAdManager&&(window.ROMAdManager.isPlaying=!0,window.ROMAdManager.scheduleInterstitialAd())},window.EJS_ready=function(){},window.EJS_adBlocked=function(e){return`/ads/emulator/fallback/${window.gameData.id}`},$(document).ready(function(){if(window.gameData&&"rom"===window.gameData.type){const e=$("#emulatorjs-container");if(e.length){const t=e.data("rom-system"),n=e.data("rom-file");if(t&&n){const e={nes:"fceumm",snes:"snes9x",gba:"mgba",gb:"gambatte",gbc:"gambatte",genesis:"genesis_plus_gx",megadrive:"genesis_plus_gx",segacd:"genesis_plus_gx",n64:"mupen64plus_next",psx:"pcsx_rearmed",atari2600:"stella",atari7800:"prosystem",lynx:"handy",jaguar:"virtualjaguar",mame:"mame2003_plus",arcade:"mame2003_plus",neogeo:"fbneo",dos:"dosbox_pure","3do":"opera",amiga:"puae",c64:"vice_x64",msx:"bluemsx",pce:"mednafen_pce_fast",pcengine:"mednafen_pce_fast",sg1000:"genesis_plus_gx",mastersystem:"genesis_plus_gx",gamegear:"genesis_plus_gx",saturn:"beetle_saturn",virtualboy:"beetle_vb",wonderswan:"mednafen_wswan",nds:"melonds"}[t.toLowerCase()]||"fceumm",a=window.gameData.thumbnailUrl||"/assets/images/default-game-thumbnail.webp";window.EJS_player="#emulatorjs-game",window.EJS_core=e,window.EJS_gameName=window.gameData.title||"ROM Game",window.EJS_color="#0097c4",window.EJS_backgroundColor="#000",window.EJS_backgroundImage=a,window.EJS_backgroundBlur=!0,window.EJS_pathtodata="/assets/js/libs/emulatorjs/",window.EJS_gameUrl=n,configureEmulatorAds(),window.EJS_Buttons={playPause:!0,restart:!0,mute:!1,settings:!1,fullscreen:!1,saveState:!1,loadState:!1,screenRecord:!1,gamepad:!0,cheat:!1,volume:!0,saveSavFiles:!1,loadSavFiles:!1,quickSave:!1,quickLoad:!1,screenshot:!1,cacheManager:!1,exitEmulation:!1},hideEmulatorContextMenu(),$("<script>").attr("src","/assets/js/libs/emulatorjs/loader.js").appendTo("head")}}}});