function showUserProfile(e){const o=window.players?window.players[e]:null;if(!o)return;const t=$("#userProfileModal"),r=$("#userProfileContent"),a=window.getRankColor?window.getRankColor(o.level):"#3B82F6";r.html(`\n        <div class="text-center mb-4">\n            <img src="${o.avatarUrl||"/assets/images/default-avatar.jpg"}" alt="Avatar" class="w-20 h-20 rounded-full mx-auto mb-3">\n            <h4 class="text-lg font-semibold text-gray-900 dark:text-white">${o.name}</h4>\n            <span class="inline-block px-2 py-1 rounded text-sm font-bold text-white" style="background-color: ${a};">\n                ${o.rankTitle}\n            </span>\n        </div>\n        \n        <div class="space-y-3">\n            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">\n                <div class="text-sm text-gray-600 dark:text-gray-300">${__("user.rank").replace("{level}","")}</div>\n                <div class="font-semibold text-gray-900 dark:text-white">${o.rankTitle}</div>\n            </div>\n            \n            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">\n                <div class="text-sm text-gray-600 dark:text-gray-300">${__("user.exp_points").replace("{points}","")}</div>\n                <div class="font-semibold text-gray-900 dark:text-white">${o.expPoints} EXP</div>\n            </div>\n            \n            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">\n                <div class="text-sm text-gray-600 dark:text-gray-300">${__("user.character")}</div>\n                <div class="font-semibold text-gray-900 dark:text-white">${o.charType||"Fighter"}</div>\n            </div>\n        </div>\n        \n        <div class="mt-4 flex space-x-3">\n            <button id="followToggleBtn" \n                    class="flex-1 bg-gray-400 dark:bg-gray-600 text-white py-2 px-4 rounded-lg font-semibold transition-colors duration-200" \n                    disabled>\n                <span class="follow-btn-text">${__("user.loading")}</span>\n            </button>\n            <button onclick="viewFullProfile('${o.name}')" \n                    class="flex-1 bg-gray-600 dark:bg-gray-500 hover:bg-gray-700 dark:hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-semibold transition-colors duration-200">\n${__("nav.profile")}\n            </button>\n        </div>\n    `),t.removeClass("hidden"),checkFollowStatusAndUpdateButton(o.name)}function closeUserProfile(){$("#userProfileModal").addClass("hidden")}function checkFollowStatusAndUpdateButton(e){$.ajax({url:`/chatroom/follow-status/${e}`,method:"GET",dataType:"json"}).done(function(o){$("#followToggleBtn"),$(".follow-btn-text");if(200===o.status){updateFollowButton(o.data.isFollowing,e)}else updateFollowButton(!1,e)}).fail(function(o,t,r){updateFollowButton(!1,e)})}function updateFollowButton(e,o){const t=$("#followToggleBtn"),r=$(".follow-btn-text");e?(t.removeClass("bg-gray-400 dark:bg-gray-600 bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600").addClass("bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-600").prop("disabled",!1).off("click").on("click",()=>toggleFollow(o,!0)),r.text(__("user.unfollow"))):(t.removeClass("bg-gray-400 dark:bg-gray-600 bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-600").addClass("bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600").prop("disabled",!1).off("click").on("click",()=>toggleFollow(o,!1)),r.text(__("user.follow")))}async function toggleFollow(e,o){const t=$("#followToggleBtn"),r=$(".follow-btn-text");t.prop("disabled",!0).removeClass("bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-600").addClass("bg-gray-400 dark:bg-gray-600"),r.text(__("user.loading"));try{const t=o?"/chatroom/unfollow-user":"/chatroom/follow-user",r=await $.post(t,{username:e});if(200===r.status){showNotification(r.message,"success");updateFollowButton(r.data.isFollowing,e)}else showNotification(r.message||__("notifications.action_failed"),"error"),updateFollowButton(o,e)}catch(t){showNotification(__("notifications.network_error"),"error"),updateFollowButton(o,e)}}async function followUser(e){toggleFollow(e,!1)}function viewFullProfile(e){closeUserProfile(),window.open(`/profile/${e}`,"_blank")}function showNotification(e,o="info"){const t=$("<div>",{class:`fixed top-4 left-1/2 transform -translate-x-1/2 ${"success"===o?"bg-green-500 dark:bg-green-600":"error"===o?"bg-red-500 dark:bg-red-600":"bg-blue-500 dark:bg-blue-600"} text-white px-4 py-2 rounded-lg shadow-lg z-50 opacity-0 transition-opacity duration-300`,text:e});$("body").append(t),setTimeout(()=>{t.removeClass("opacity-0").addClass("opacity-100")},100),setTimeout(()=>{t.addClass("opacity-0"),setTimeout(()=>{t.remove()},300)},3e3)}function getDarkModePreference(){const e=localStorage.getItem("darkMode");return null!==e?"true"===e:!!window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}function setDarkMode(e){try{const o=$("html");e?o.addClass("dark"):o.removeClass("dark"),localStorage.setItem("darkMode",e.toString()),o[0].offsetHeight}catch(e){}}function toggleDarkMode(){try{const e=$("html"),o=!e.hasClass("dark");setDarkMode(o),$(document).trigger("darkModeChanged",{isDark:o})}catch(e){}}function initChatroomDarkMode(){if("undefined"==typeof $)return;$("html").addClass("no-transitions");setDarkMode(getDarkModePreference()),setTimeout(()=>{$("html").removeClass("no-transitions")},100),setupChatroomDarkModeHandler()}function setupChatroomDarkModeHandler(){if("undefined"==typeof $)return;const e=$("#chatroomDarkModeToggle");$(document).off("click.chatroomDarkMode").on("click.chatroomDarkMode","#chatroomDarkModeToggle",function(e){e.preventDefault(),e.stopPropagation(),toggleDarkMode()}),e.length>0&&e.off("click.chatroomDarkModeDirect").on("click.chatroomDarkModeDirect",function(e){e.preventDefault(),e.stopPropagation(),toggleDarkMode()})}$(document).ready(function(){initChatroomDarkMode(),$("#sendBtn").on("click",function(){const e=$("#chatInput");if(e.val().trim()){const o=new KeyboardEvent("keydown",{key:"Enter"});Object.defineProperty(o,"target",{value:e[0],enumerable:!0}),e[0].dispatchEvent(o)}}),$("#chatContainer").hide()}),window.showUserProfile=showUserProfile,window.closeUserProfile=closeUserProfile,window.followUser=followUser,window.viewFullProfile=viewFullProfile,window.initChatroomDarkMode=initChatroomDarkMode;