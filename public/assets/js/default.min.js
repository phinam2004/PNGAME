!function(e){"use strict";function t(){const t=window.location.pathname,n=["/login","/register","/forgot-password","/reset-password"].some(e=>t.includes(e)),a=e(".g-recaptcha").length>0;if(n&&a&&"undefined"==typeof grecaptcha&&!window.recaptchaLoading&&!document.querySelector('script[src*="recaptcha/api.js"]')&&"undefined"==typeof grecaptcha){window.recaptchaLoading=!0;const t=document.createElement("script");t.src="https://www.google.com/recaptcha/api.js",t.async=!0,t.defer=!0,t.onload=function(){window.recaptchaLoading=!1,setTimeout(function(){"undefined"!=typeof grecaptcha&&e(".g-recaptcha").each(function(){const t=e(this).data("sitekey");t&&!e(this).children().length&&grecaptcha.render(this,{sitekey:t})})},100)},t.onerror=function(){window.recaptchaLoading=!1},document.head.appendChild(t)}a&&"undefined"!=typeof grecaptcha&&e(".g-recaptcha").each(function(){const t=e(this).data("sitekey");t&&!e(this).children().length&&grecaptcha.render(this,{sitekey:t})})}function n(){t(),e("[system-auth-form]").on("submit",function(t){t.preventDefault();const n=e(this).attr("system-auth-form"),a=new FormData(this),o=e(this).find('button[type="submit"]'),r=o.find(".btn-text"),s=o.find(".btn-loading");o.prop("disabled",!0),r.addClass("hidden"),s.removeClass("hidden"),e(".text-red-500").addClass("hidden"),e.ajax({url:`/auth/${n}`,type:"POST",data:a,processData:!1,contentType:!1,success:function(e){200===e.status?alert.success(e.message,!0):(alert.danger(e.message),o.prop("disabled",!1),r.removeClass("hidden"),s.addClass("hidden"),"undefined"!=typeof grecaptcha&&grecaptcha.reset())},error:function(t){let n=__("errors.generic"),a=!1,i="",l=!1;try{const e=JSON.parse(t.responseText);n=e.message||e.error||n,"CSRF_INVALID"===e.code?(l=!0,n=__("errors.csrf_expired")):"RATE_LIMIT_EXCEEDED"===e.code?n=__("errors.rate_limit"):"AUTH_RATE_LIMIT_EXCEEDED"===e.code?n=__("errors.auth_rate_limit"):e.data&&"email_not_verified"===e.data.error_type&&(a=!0,i=e.data.email||"")}catch(e){}if(l?alert.warning(n,!0):alert.danger(n),a){const t=e("#emailVerificationSection");t.removeClass("hidden"),t.data("email",i)}o.prop("disabled",!1),r.removeClass("hidden"),s.addClass("hidden"),"undefined"!=typeof grecaptcha&&grecaptcha.reset()}})}),e(document).off("click","#resendVerificationBtn").on("click","#resendVerificationBtn",function(){const t=e(this),n=t.find(".btn-text"),a=t.find(".btn-loading"),o=e("#emailVerificationSection").data("email")||e("#username").val();o?(t.prop("disabled",!0),n.addClass("hidden"),a.removeClass("hidden"),e.ajax({url:"/auth/resend-verification",type:"POST",data:{email:o,_csrf:e('meta[name="csrf-token"]').attr("content")||e('input[name="_csrf"]').val()},success:function(e){200===e.status?alert.success(e.message):alert.danger(e.message)},error:function(e){let t=__("errors.email_send_failed"),n=!1;try{const a=JSON.parse(e.responseText);t=a.message||a.error||t,"CSRF_INVALID"===a.code?(n=!0,t=__("errors.csrf_expired")):"RATE_LIMIT_EXCEEDED"===a.code?t=__("errors.rate_limit"):"AUTH_RATE_LIMIT_EXCEEDED"===a.code&&(t=__("errors.auth_rate_limit_attempts"))}catch(e){}n?alert.warning(t,!0):alert.danger(t)},complete:function(){t.prop("disabled",!1),n.removeClass("hidden"),a.addClass("hidden")}})):alert.danger(__("auth.email_required"))})}function a(){e("html").addClass("no-transitions");s(function(){const e=localStorage.getItem("darkMode");if(null!==e)return"true"===e;if(window.matchMedia)return window.matchMedia("(prefers-color-scheme: dark)").matches;return!1}()),setTimeout(()=>{e("html").removeClass("no-transitions")},100)}function o(){const t=e("#darkModeToggle, #mobileDarkModeToggle");t.off("click.darkmode"),t.on("click.darkmode",function(e){e.preventDefault(),e.stopPropagation(),i()}),t.each(function(){const t=e(this);"none"===t.css("display")||t.css("visibility")})}function r(){if("undefined"==typeof MutationObserver)return;new MutationObserver(function(t){let n=!1;t.forEach(function(t){"childList"===t.type&&t.addedNodes.forEach(function(t){if(1===t.nodeType){const a=e(t);(a.is("#darkModeToggle, #mobileDarkModeToggle")||a.find("#darkModeToggle, #mobileDarkModeToggle").length>0)&&(n=!0)}})}),n&&setTimeout(()=>{o()},100)}).observe(document.body,{childList:!0,subtree:!0})}function s(t){try{const n=e("html");t?n.addClass("dark"):n.removeClass("dark"),localStorage.setItem("darkMode",t.toString()),n[0].offsetHeight}catch(e){}}function i(){try{const t=e("html"),n=!t.hasClass("dark");s(n),e(document).trigger("darkModeChanged",{isDark:n})}catch(e){}}function l(){e("#forgotPasswordForm").on("submit",function(t){t.preventDefault();const n=e(this),a=e("#submitBtn"),o=a.find(".btn-text"),r=a.find(".btn-loading");a.prop("disabled",!0),o.addClass("hidden"),r.removeClass("hidden");const s=new FormData(this);if("undefined"!=typeof grecaptcha)try{const e=grecaptcha.getResponse();e&&s.append("g-recaptcha-response",e)}catch(t){}e.ajax({url:"/auth/forgot-password",type:"POST",data:s,processData:!1,contentType:!1,success:function(e){if(200===e.status){if(alert.success(e.message||__("auth.reset_link_sent")),n[0].reset(),"undefined"!=typeof grecaptcha)try{grecaptcha.reset()}catch(e){}}else if(alert.danger(e.message||__("notifications.error")),"undefined"!=typeof grecaptcha)try{grecaptcha.reset()}catch(e){}},error:function(e){let t=__("errors.network_error");try{t=JSON.parse(e.responseText).message||t}catch(e){}if(alert.danger(t),"undefined"!=typeof grecaptcha)try{grecaptcha.reset()}catch(e){}},complete:function(){a.prop("disabled",!1),o.removeClass("hidden"),r.addClass("hidden")}})})}function d(){e("#resetPasswordForm").on("submit",function(t){t.preventDefault();e(this);const n=e("#resetSubmitBtn"),a=n.find(".btn-text"),o=n.find(".btn-loading");n.prop("disabled",!0),a.addClass("hidden"),o.removeClass("hidden");const r=new FormData(this);if("undefined"!=typeof grecaptcha)try{const e=grecaptcha.getResponse();e&&r.append("g-recaptcha-response",e)}catch(t){}e.ajax({url:"/auth/reset-password",type:"POST",data:r,processData:!1,contentType:!1,success:function(e){if(200===e.status)alert.success(e.message||__("auth.password_reset_success")),setTimeout(function(){window.location.href="/login"},2e3);else if(alert.danger(e.message||__("auth.password_reset_failed")),"undefined"!=typeof grecaptcha)try{grecaptcha.reset()}catch(e){}},error:function(e){let t=__("errors.generic");try{t=JSON.parse(e.responseText).message||t}catch(e){}if(alert.danger(t),"undefined"!=typeof grecaptcha)try{grecaptcha.reset()}catch(e){}},complete:function(){n.prop("disabled",!1),a.removeClass("hidden"),o.addClass("hidden")}})}),function(){if(!e("#resetPasswordForm").length)return;const t=document.getElementById("password"),n=document.getElementById("confirm_password"),a=document.getElementById("password-strength"),o=document.getElementById("strength-bar"),r=document.getElementById("strength-text");document.getElementById("togglePassword"),document.getElementById("toggleConfirmPassword"),document.getElementById("eyeIcon"),document.getElementById("eyeIconConfirm");t&&o&&e(t).off("input.resetPassword").on("input.resetPassword",function(){const e=this.value,t=s(e);e.length>0?(a.classList.remove("hidden"),o.style.width=t.score+"%",o.className=`h-2 rounded-full transition-all duration-300 ${t.color}`,r.textContent=t.text,r.className=`text-xs font-medium ${t.textColor}`):a.classList.add("hidden")});n&&e(n).off("input.resetPassword").on("input.resetPassword",function(){const e=t.value,n=this.value;n.length>0?this.style.borderColor=e===n?"#10B981":"#EF4444":this.style.borderColor="#D1D5DB"});function s(e){let t=0,n="",a="",o="";return e.length>=6&&(t+=20),e.length>=8&&(t+=20),/[a-z]/.test(e)&&(t+=20),/[A-Z]/.test(e)&&(t+=20),/[0-9]/.test(e)&&(t+=10),/[^A-Za-z0-9]/.test(e)&&(t+=10),t<30?(n=__("password.strength.weak"),a="bg-red-500",o="text-red-600"):t<60?(n=__("password.strength.fair"),a="bg-yellow-500",o="text-yellow-600"):t<80?(n=__("password.strength.good"),a="bg-blue-500",o="text-blue-600"):(n=__("password.strength.strong"),a="bg-green-500",o="text-green-600"),{score:t,text:n,color:a,textColor:o}}}()}function c(){e("#userDropdownBtn").on("click",function(t){t.stopPropagation(),e("#userDropdown").slideToggle(200)}),e("#mobileUserDropdownBtn").on("click",function(t){t.stopPropagation(),e("#mobileUserDropdown").slideToggle(200)}),e(document).on("click",function(t){e(t.target).closest("[system-usernav]").length||e("#userDropdown, #mobileUserDropdown").slideUp(200)})}function u(){!function(){const t=e("#avatarUpload"),n=e("#avatarPreview"),a=e("#avatarDropZone"),o=e("#avatarOverlay"),r=(e("#avatarProgress"),e("#avatarProgressBar"),e("#avatarProgressText"),e("#removeAvatarBtn"));if(!t.length)return;function s(e){if(!["image/jpeg","image/jpg","image/png","image/gif"].includes(e.type))return void alert.danger(__("settings.avatar_format_error"));if(e.size>5242880)return void alert.danger(__("settings.avatar_size_error"));const a=new FileReader;a.onload=function(e){n.attr("src",e.target.result),r.removeClass("hidden")},a.readAsDataURL(e);const o=new DataTransfer;o.items.add(e),t[0].files=o.files}t.on("change",function(e){const t=e.target.files[0];t&&s(t)}),a.on("dragover",function(t){t.preventDefault(),e(this).addClass("border-orange-400 bg-orange-50")}),a.on("dragleave",function(t){t.preventDefault(),e(this).removeClass("border-orange-400 bg-orange-50")}),a.on("drop",function(t){t.preventDefault(),e(this).removeClass("border-orange-400 bg-orange-50");const n=t.originalEvent.dataTransfer.files;n.length>0&&s(n[0])}),n.on("mouseenter",function(){o.removeClass("hidden").addClass("flex")}),n.on("mouseleave",function(){o.addClass("hidden").removeClass("flex")}),r.on("click",function(){const t=e("#profileForm"),a=new FormData(t[0]);a.append("remove_avatar","true"),e.ajax({url:"/requests/update-profile",type:"POST",data:a,processData:!1,contentType:!1,success:function(e){200===e.status?(n.attr("src","/assets/images/default-avatar.jpg"),r.addClass("hidden"),alert.success(__("settings.avatar_removed_success"),!0)):alert.danger(e.message)},error:function(e){const t=e.responseJSON?.message||__("settings.avatar_upload_error");alert.danger(t)}})})}(),e("[system-settings-form]").on("submit",function(t){t.preventDefault();const n=e(this).attr("system-settings-form"),a=new FormData(this),o=e(this).find('button[type="submit"]'),r=o.find(".btn-text"),s=o.find(".btn-loading");o.prop("disabled",!0),r.addClass("hidden"),s.removeClass("hidden"),e(".text-red-500").addClass("hidden"),e.ajax({url:`/requests/update-${n}`,type:"POST",data:a,processData:!1,contentType:!1,success:function(t){200===t.status?("password"===n&&e(`[system-settings-form="${n}"]`)[0].reset(),"profile"===n&&a.has("avatar")?alert.success(t.message,!0):alert.success(t.message)):alert.danger(t.message),o.prop("disabled",!1),r.removeClass("hidden"),s.addClass("hidden")},error:function(t){let n=__("errors.generic");try{const a=JSON.parse(t.responseText);n=a.message||n,a.errors&&Object.keys(a.errors).forEach(t=>{const n=e(`#${t}Error`);n.length&&n.text(a.errors[t]).removeClass("hidden")})}catch(e){}response&&response.errors||alert.danger(n),o.prop("disabled",!1),r.removeClass("hidden"),s.addClass("hidden")}})}),e("#new_password").on("input",function(){const t=e(this).val(),n=e("#passwordStrength"),a=e("#strengthText"),o=n.find(".h-1");if(0===t.length)return void n.addClass("hidden");n.removeClass("hidden");let r=0;t.length>=8&&r++,/[a-z]/.test(t)&&r++,/[A-Z]/.test(t)&&r++,/[0-9]/.test(t)&&r++,/[^A-Za-z0-9]/.test(t)&&r++,o.removeClass("bg-red-400 bg-yellow-400 bg-blue-400 bg-green-400").addClass("bg-gray-200");const s=[{text:__("password.strength.very_weak"),color:"bg-red-400",bars:1},{text:__("password.strength.weak"),color:"bg-red-400",bars:1},{text:__("password.strength.fair"),color:"bg-yellow-400",bars:2},{text:__("password.strength.good"),color:"bg-blue-400",bars:3},{text:__("password.strength.strong"),color:"bg-green-400",bars:4}][Math.min(r,4)];a.text(s.text);for(let e=0;e<s.bars;e++)o.eq(e).removeClass("bg-gray-200").addClass(s.color)}),e("#exportDataBtn").on("click",function(){iziToast.question({title:__("user.export_data_title"),message:__("user.export_data_message"),position:"center",backgroundColor:"#3B82F6",titleColor:"#fff",messageColor:"#fff",icon:!1,timeout:!1,close:!1,overlay:!0,buttons:[[`<button style="color: white;">${__("user.export")}</button>`,function(e,t){e.hide({transitionOut:"fadeOut"},t,"button"),window.location.href="/requests/export-data"},!0],[`<button style="color: white;">${__("games.cancel")}</button>`,function(e,t){e.hide({transitionOut:"fadeOut"},t,"button")}]]})}),m()}function m(){const t=e(".system-country-select");0!==t.length&&t.each(function(){const t=e(this);if(t.siblings(`input[placeholder="${__("forms.search_countries")}"]`).length>0)return;const n=t.val();!function(t,n){const a=e('<div class="relative"></div>'),o=e(`<input type="text" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md placeholder-gray-400 transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg" placeholder="${__("forms.search_countries")}">`),r=e('<div class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto hidden"></div>'),s=[];if(t.find("option").each(function(){const t=e(this);s.push({value:t.val(),text:t.text(),selected:t.prop("selected")})}),t.hide(),t.wrap(a),t.after(r),t.after(o),n){const e=s.find(e=>e.value===n);e&&(o.val(e.text),t.val(n))}else o.val(""),t.val("");function i(t=""){r.empty();const n=s.filter(e=>e.text.toLowerCase().includes(t.toLowerCase())||e.value.toLowerCase().includes(t.toLowerCase()));0===n.length?r.append('<div class="px-4 py-2 text-gray-500">No countries found</div>'):n.forEach(t=>{if(""===t.value)return;const n=e(`<div class="px-4 py-2 cursor-pointer hover:bg-blue-50 hover:text-blue-700 transition-colors duration-200" data-value="${t.value}">${t.text}</div>`);r.append(n)}),r.show()}o.on("input focus",function(){i(e(this).val())}),o.on("input",function(){""===e(this).val()&&t.val("").trigger("change")}),r.on("click","[data-value]",function(){const n=e(this).data("value"),a=e(this).text();o.val(a),t.val(n).trigger("change"),r.hide()}),o.on("blur",function(){setTimeout(()=>r.hide(),200)}),e(document).on("click",function(t){e(t.target).closest(o.parent()).length||r.hide()})}(t,n)})}function g(){e(document).off("click","#followUserBtn").on("click","#followUserBtn",function(){const t=e(this),n=t.data("username")||t.closest("[data-username]").data("username"),a=t.html();n?(t.prop("disabled",!0).html('<svg class="w-4 h-4 animate-spin inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> '+__("user.following_loading")),e.ajax({url:"/requests/follow-user",method:"POST",data:{username:n},success:function(n){if(200===n.status){t.removeClass("bg-blue-600 hover:bg-blue-700").addClass("bg-gray-600 hover:bg-gray-700").attr("id","unfollowUserBtn").prop("disabled",!1).html('<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> '+__("user.following")),alert.success(n.message);const a=e("#followerCount");if(a.length){const e=parseInt(a.text())||0;a.text(e+1)}}else t.prop("disabled",!1).html(a),alert.danger(n.message)},error:function(e){t.prop("disabled",!1).html(a);const n=e.responseJSON?.message||__("notifications.follow_failed");alert.danger(n)}})):alert.danger(__("auth.username_not_found"))}),e(document).off("click","#unfollowUserBtn").on("click","#unfollowUserBtn",function(){const t=e(this),n=t.data("username")||t.closest("[data-username]").data("username"),a=t.html(),o=window.__("user.unfollow_user"),r=window.__("user.unfollow_confirm"),s=window.__("user.unfollow"),i=window.__("games.cancel");iziToast.question({title:o,message:r,position:"center",backgroundColor:"#EF4444",titleColor:"#fff",messageColor:"#fff",icon:!1,timeout:!1,close:!1,overlay:!0,buttons:[[`<button style="color: white;">${s}</button>`,function(o,r){o.hide({transitionOut:"fadeOut"},r,"button"),t.prop("disabled",!0).html('<svg class="w-4 h-4 animate-spin inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> '+__("user.unfollowing_loading")),e.ajax({url:"/requests/unfollow-user",method:"POST",data:{username:n},success:function(n){if(200===n.status){t.removeClass("bg-gray-600 hover:bg-gray-700").addClass("bg-blue-600 hover:bg-blue-700").attr("id","followUserBtn").prop("disabled",!1).html('<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg> '+__("user.follow")),alert.warning(n.message);const a=e("#followerCount");if(a.length){const e=parseInt(a.text())||0;a.text(Math.max(0,e-1))}}else t.prop("disabled",!1).html(a),alert.danger(n.message)},error:function(e){t.prop("disabled",!1).html(a);const n=e.responseJSON?.message||window.__("user.failed_to_unfollow");alert.danger(n)}})},!0],[`<button style="color: white;">${i}</button>`,function(e,t){e.hide({transitionOut:"fadeOut"},t,"button")}]]})})}e(function(){!function(){const t=e("#menuBtn"),n=e("#closeBtn"),a=e("#sidebar"),o=e("#overlay");function r(){"rtl"===document.documentElement.dir?a.removeClass("translate-x-full").addClass("translate-x-0"):a.removeClass("-translate-x-full").addClass("translate-x-0"),o.removeClass("hidden"),e("body").css("overflow","hidden")}function s(){"rtl"===document.documentElement.dir?a.removeClass("translate-x-0").addClass("translate-x-full"):a.removeClass("translate-x-0").addClass("-translate-x-full"),o.addClass("hidden"),e("body").css("overflow","")}t.on("click",r),n.on("click",s),o.on("click",s),e(document).on("keydown",function(e){const t=a.hasClass("translate-x-0");"Escape"===e.key&&t&&s()}),e(window).on("resize",function(){const e=a.hasClass("translate-x-0");window.innerWidth>=1024&&e&&s()})}(),e('[id$="-list"]').each(function(){const t=this;let n,a,o=!1;e(t).on("mousedown",function(e){o=!0,t.style.cursor="grabbing",n=e.pageX-t.offsetLeft,a=t.scrollLeft}),e(t).on("mouseleave",function(){o=!1,t.style.cursor="grab"}),e(t).on("mouseup",function(){o=!1,t.style.cursor="grab"}),e(t).on("mousemove",function(e){if(!o)return;e.preventDefault();const r=2*(e.pageX-t.offsetLeft-n);t.scrollLeft=a-r})}),n(),l(),d(),c(),u(),alert.setup(),system.modals(),system.delete(),system.actions(),!1!==window.FRONTEND_PJAX_ENABLED&&(window.pjax=new Pjax({scrollTo:0,cacheBust:!1,elements:"[system-nav]",selectors:["title","[system-navbar]","[system-usernav]","[system-wrapper]"]}),e(document).on("pjax:send",function(){topbar.show(),window.FlashAdManager&&"function"==typeof window.FlashAdManager.destroy&&window.FlashAdManager.destroy(),D()}),e(document).on("pjax:complete",function(){F(),N(),n(),l(),d(),c(),u(),m(),g(),p(),b(),j(),t(),a(),setTimeout(()=>{o()},200),topbar.hide()})),g(),p(),"undefined"!=typeof FloatingChatSystem&&setTimeout(()=>{window.floatingChat=new FloatingChatSystem},500),window.scrollCarousel=function(e,t){const n=document.getElementById(e);if(!n)return;const a=200;"prev"===t?n.scrollBy({left:-a,behavior:"smooth"}):n.scrollBy({left:a,behavior:"smooth"})},b(),j(),N(),function(){const t=e("#gameSearch"),n=e("#searchResults"),a=e("#searchContent"),o=e("#searchLoading"),r=e("#searchNoResults"),s=e("#clearSearch");if(!t.length)return;if(t.data("search-initialized"))return;let i;t.data("search-initialized",!0);let l=null,d=!1;function c(t){l&&4!==l.readyState&&l.abort(),m(),o.removeClass("hidden"),a.empty(),r.addClass("hidden"),l=e.ajax({url:"/requests/search-games",method:"GET",data:{q:t,limit:6},success:function(e){l=null,o.addClass("hidden"),200===e.status&&e.data.games.length>0?u(e.data.games,t,e.data.totalCount):r.removeClass("hidden")},error:function(e){l=null,"abort"!==e.statusText&&(o.addClass("hidden"),r.removeClass("hidden"))}})}function u(e,t,n){let o="";e.forEach((e,t)=>{let n;if(e.thumbnail)try{if("string"==typeof e.thumbnail&&e.thumbnail.startsWith("{")){const t=JSON.parse(e.thumbnail);n=t.webp&&t.webp.thumbnail?"/"+t.webp.thumbnail.relativePath:t.webp&&t.webp.standard?"/"+t.webp.standard.relativePath:t.original&&t.original.thumbnail?"/"+t.original.thumbnail.relativePath:t.original&&t.original.standard?"/"+t.original.standard.relativePath:e.thumbnail.startsWith("/")?e.thumbnail:"/"+e.thumbnail}else n=e.thumbnail.startsWith("/")?e.thumbnail:"/"+e.thumbnail}catch(t){n=e.thumbnail.startsWith("/")?e.thumbnail:"/"+e.thumbnail}else n=`https://dummyimage.com/80x60/9CA3AF/FFFFFF?text=${encodeURIComponent(e.title.charAt(0))}`;const a={};a[__("categories.action")]="bg-red-100 text-red-700",a[__("categories.adventure")]="bg-green-100 text-green-700",a[__("categories.puzzle")]="bg-purple-100 text-purple-700",a[__("categories.sports")]="bg-blue-100 text-blue-700",a[__("categories.racing")]="bg-orange-100 text-orange-700",a[__("categories.strategy")]="bg-indigo-100 text-indigo-700";const r=a[e.category_name]||"bg-gray-100 text-gray-700",s=e.play_count?e.play_count>=1e3?Math.floor(e.play_count/1e3)+"k":e.play_count:"0";o+=`\n                    <a href="/play/${e.slug}" class="search-result-item group flex items-center p-4 hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-300 border-b border-gray-50 last:border-b-0" system-nav>\n                        <div class="relative flex-shrink-0 mr-4">\n                            <img src="${n}" alt="${e.title}" class="w-16 h-12 rounded-xl object-cover shadow-sm group-hover:shadow-md transition-shadow duration-300">\n                            <div class="absolute -top-1 -right-1 w-6 h-6 bg-white rounded-full shadow-sm flex items-center justify-center text-xs font-bold text-gray-600">\n                                ${t+1}\n                            </div>\n                        </div>\n                        <div class="flex-1 min-w-0">\n                            <div class="flex items-start justify-between mb-1">\n                                <h4 class="text-sm font-semibold text-gray-900 truncate pr-2 group-hover:text-blue-700 transition-colors duration-200">${e.title}</h4>\n                                <div class="flex items-center space-x-1 flex-shrink-0">\n                                    <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25m18 0A2.25 2.25 0 0018.75 3H5.25A2.25 2.25 0 003 5.25m18 0V12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 12V5.25"/>\n                                    </svg>\n                                </div>\n                            </div>\n                            <div class="flex items-center space-x-2 mb-2">\n                                <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ${r}">\n                                    ${e.category_name||__("categories.default")}\n                                </span>\n                                <div class="flex items-center text-xs text-gray-500">\n                                    <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25m18 0A2.25 2.25 0 0018.75 3H5.25A2.25 2.25 0 003 5.25m18 0V12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 12V5.25"/>\n                                    </svg>\n                                    <span>${s} plays</span>\n                                </div>\n                            </div>\n                            ${e.rating?`\n                                <div class="flex items-center space-x-1">\n                                    <div class="flex items-center">\n                                        ${"★".repeat(Math.floor(e.rating))}${"☆".repeat(5-Math.floor(e.rating))}\n                                    </div>\n                                    <span class="text-xs text-gray-500">${parseFloat(e.rating).toFixed(1)}</span>\n                                </div>\n                            `:""}\n                        </div>\n                    </a>\n                `}),n>e.length&&(o+=`\n                    <div class="bg-gradient-to-r from-gray-50 to-blue-50 border-t border-gray-100">\n                        <a href="/search/${encodeURIComponent(t)}" class="flex items-center justify-center p-4 text-sm text-blue-600 hover:text-blue-700 transition-colors duration-200 font-semibold group" system-nav>\n                            <div class="flex items-center space-x-2">\n                                <span>${__("search.see_all_results",{count:n.toLocaleString()})}</span>\n                                <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"/>\n                                </svg>\n                            </div>\n                        </a>\n                    </div>\n                `),a.html(o)}function m(){d||(n.removeClass("hidden"),d=!0)}function g(){d&&(n.addClass("hidden"),o.addClass("hidden"),r.addClass("hidden"),d=!1)}s.on("click",function(){l&&4!==l.readyState&&(l.abort(),l=null),clearTimeout(i),t.val("").trigger("input").focus()}),t.on("input",function(){const t=e(this).val().trim();return t.length>0?(s.removeClass("hidden"),clearTimeout(i),t.length<2?(l&&4!==l.readyState&&(l.abort(),l=null),void g()):void(i=setTimeout(()=>{c(t)},300))):(s.addClass("hidden"),l&&4!==l.readyState&&(l.abort(),l=null),clearTimeout(i),void g())}),t.on("keydown",function(t){if("Enter"===t.key){t.preventDefault();const n=e(this).val().trim();n.length>=2&&(window.location.href=`/search/${encodeURIComponent(n)}`)}}),e(document).on("click",function(t){e(t.target).closest("#gameSearch, #searchResults").length||g()}),e(document).on("click","#searchContent .search-result-item",function(t){t.preventDefault();const n=e(this).attr("href");g(),window.pjax?window.pjax.loadUrl(n):window.location.href=n}),e(document).on("pjax:send",function(){D(),window.FlashAdManager&&"function"==typeof window.FlashAdManager.destroy&&window.FlashAdManager.destroy()})}(),function(){const t=e("#languageDropdownBtn"),n=e("#languageDropdown");t.length&&n.length&&(t.on("click",function(e){e.stopPropagation(),n.toggleClass("hidden"),n.hasClass("hidden")||O(n)}),e(document).on("click",function(t){e(t.target).closest("#languageSwitcher").length||n.addClass("hidden")}),t.on("keydown",function(e){q(e,n)}));const a=e("#mobileLanguageDropdownBtn"),o=e("#mobileLanguageDropdown");a.length&&o.length&&(a.on("click",function(e){e.stopPropagation(),o.toggleClass("hidden"),o.hasClass("hidden")||O(o)}),e(document).on("click",function(t){e(t.target).closest("#mobileLanguageSwitcher").length||o.addClass("hidden")}),a.on("keydown",function(e){q(e,o)}))}(),F(),I()&&(z(),setTimeout(()=>{A(),setInterval(()=>A(),3e5)},3e4)),e(".category-link").each(function(){const t=e(this),n=t.css("--category-color")||t.data("category-color")||"#6366F1",a=t.css("background");t.on("mouseenter",function(){e(this).css("background",`linear-gradient(135deg, ${n}90 0%, ${n}70 100%)`)}),t.on("mouseleave",function(){e(this).css("background",a)})}),e(document).on("click",'[id^="toggle"][id*="Password"]',function(){const t=e(this),n={togglePassword:"#password",toggleConfirmPassword:"#confirm_password",toggleCurrentPassword:"#current_password",toggleNewPassword:"#new_password"}[t.attr("id")];if(!n)return;const a=e(n);if(0===a.length)return;const o="password"===a.attr("type")?"text":"password";a.attr("type",o);const r=t.find("svg").first();r.length>0&&("text"===o?r.html('\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L12 12m3.121-3.121L21 21m-6.879-6.879L12 12m0 0l3.121-3.121"/>\n                    '):r.html('\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>\n                    '))}),a(),o(),e(document).off("click.darkmode-global").on("click.darkmode-global","#darkModeToggle, #mobileDarkModeToggle",function(e){e.preventDefault(),e.stopPropagation(),i()}),r()}),window.debugDarkMode=function(){const t=e("html"),n=e("#darkModeToggle, #mobileDarkModeToggle"),a=t.hasClass("dark")?"dark":"light",o=localStorage.getItem("darkMode");return n.each(function(t){e(this)}),{currentMode:a,storedMode:o,buttonsFound:n.length,htmlClasses:t.attr("class")}},window.testDarkModeToggle=function(){i()},e(document).ready(function(){r(),setInterval(function(){const t=e("html").hasClass("dark"),n="true"===localStorage.getItem("darkMode");t!==n&&s(n)},5e3)});let f=null;function p(){"undefined"!=typeof io&&h()}function h(){if(f&&f.connected)return;let t=sessionStorage.getItem("socket_token");t||(t="session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),sessionStorage.setItem("socket_token",t));const n={};window.user&&window.user.id&&(n.userId=window.user.id,n.token=t),f=io({auth:n,transports:["websocket","polling"],timeout:5e3}),f.on("connect",function(){x(!0)}),f.on("disconnect",function(e){x(!1)}),f.on("connect_error",function(e){x(!1)}),f.on("connected",function(e){}),f.on("user_followed",function(t){!function(t){if(v(`${t.followerUsername} started following you`,"primary"),window.location.pathname.includes("/profile")){const t=e("#followerCount");if(t.length){const e=parseInt(t.text())||0;t.text(e+1)}}}(t)}),f.on("user_unfollowed",function(t){!function(t){if(v(`${t.followerUsername} unfollowed you`,"warning"),window.location.pathname.includes("/profile")){const t=e("#followerCount");if(t.length){const e=parseInt(t.text())||0;t.text(Math.max(0,e-1))}}}(t)}),f.on("user_online",function(e){!function(e){w(e.userId,!0)}(e)}),f.on("user_offline",function(e){!function(e){w(e.userId,!1)}(e)}),f.on("game_started",function(e){!function(e){v(e.message,"primary")}(e)}),f.on("game_finished",function(e){!function(e){v(e.message,"primary")}(e)}),f.on("notification",function(e){!function(e){v(e.message,e.type||"primary")}(e)}),f.on("personal_best_notification",function(e){!function(e){iziToast.success({title:__("user.personal_best_title"),message:e.message,position:"topLeft",timeout:8e3,backgroundColor:"#10b981",titleColor:"#fff",messageColor:"#fff",icon:!1,displayMode:"replace",buttons:[[`<button style="color: white;">${__("user.view_profile")}</button>`,function(t,n){window.pjax?pjax.loadUrl(`/profile/${e.username}`):window.location.href=`/profile/${e.username}`,t.hide({transitionOut:"fadeOut"},n,"button")}]]})}(e)}),f.on("game_viewer_count",function(e){E(e.gameId,e.viewerCount)}),f.on("error",function(e){!function(e){alert.danger(e.message)}(e)}),setInterval(function(){f&&f.connected&&f.emit("heartbeat")},3e4),e(window).on("beforeunload",function(){f&&f.disconnect(),D()})}function x(t){const n=e("#connectionStatus");n.length&&(t?n.removeClass("bg-red-500").addClass("bg-green-500").attr("title",__("notifications.connected")):n.removeClass("bg-green-500").addClass("bg-red-500").attr("title",__("notifications.disconnected")))}function w(t,n){e(`.user-${t}-status`).each(function(){const t=e(this);n?t.removeClass("bg-gray-400").addClass("bg-green-400").attr("title",__("notifications.online")):t.removeClass("bg-green-400").addClass("bg-gray-400").attr("title",__("notifications.offline"))})}function v(e,t){switch(t){case"success":alert.success(e);break;case"error":alert.danger(e);break;case"warning":alert.warning(e);break;default:alert.primary(e)}}function b(){if(!e("#game-container").length)return;const t=window.location.pathname.split("/"),n=t[t.length-1];n&&"play"!==n&&e.ajax({url:`/requests/game-data/${n}`,method:"GET",success:function(t){200===t.status?(window.gameData=t.data,function(){if(window.gameData&&"flash"===window.gameData.type){const t=e("#ruffle-player");if(t.length){const e=t.data("game-src");if(!e)return;const n=window.__("games.loading_game"),a=window.__("games.loading_game_message");if(t.html(`\n                    <div class="flex flex-col items-center justify-center h-full p-8 text-center">\n                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>\n                        <div class="text-lg font-medium text-gray-700 mb-2">${n}</div>\n                        <div class="text-sm text-gray-500">${a}</div>\n                    </div>\n                `),document.querySelector('script[src="/assets/js/ads.flash.min.js"]')||window.FlashAdManager)if(document.querySelector('script[src="/assets/js/libs/ruffle/ruffle.js"]')||window.RufflePlayer)y(t,e);else{const n=document.createElement("script");n.src="/assets/js/libs/ruffle/ruffle.js",n.onload=function(){y(t,e)},n.onerror=function(){t.html('<div class="text-center text-red-500 p-4">'+__("notifications.flash_load_failed")+"</div>")},document.head.appendChild(n)}else{const n=document.createElement("script");n.src="/assets/js/ads.flash.min.js",n.onload=function(){if(document.querySelector('script[src="/assets/js/libs/ruffle/ruffle.js"]')||window.RufflePlayer)y(t,e);else{const n=document.createElement("script");n.src="/assets/js/libs/ruffle/ruffle.js",n.onload=function(){y(t,e)},n.onerror=function(){t.html('<div class="text-center text-red-500 p-4">'+__("notifications.flash_load_failed")+"</div>")},document.head.appendChild(n)}},n.onerror=function(){if(document.querySelector('script[src="/assets/js/libs/ruffle/ruffle.js"]')||window.RufflePlayer)y(t,e);else{const n=document.createElement("script");n.src="/assets/js/libs/ruffle/ruffle.js",n.onload=function(){y(t,e)},n.onerror=function(){t.html('<div class="text-center text-red-500 p-4">'+__("notifications.flash_load_failed")+"</div>")},document.head.appendChild(n)}},document.head.appendChild(n)}}}if(window.gameData)if(document.querySelector('script[src="/assets/js/score.min.js"]')){if(window.gameData.id&&(window.currentGameId=window.gameData.id),("html"===window.gameData.type||"embed"===window.gameData.type)&&!window.gameData.api_enabled)if(document.querySelector('script[src="/assets/js/ads.general.min.js"]')||window.GeneralAdManager){if(window.GeneralAdManager){const t=e("#game-frame")[0];t&&window.GeneralAdManager.init(t)}}else{const t=document.createElement("script");t.src="/assets/js/ads.general.min.js",t.onload=function(){const t=e("#game-frame")[0];t&&window.GeneralAdManager&&window.GeneralAdManager.init(t)},t.onerror=function(){},document.head.appendChild(t)}}else{const t=document.createElement("script");t.src="/assets/js/score.min.js",t.onload=function(){if(window.gameData.id&&(window.currentGameId=window.gameData.id),("html"===window.gameData.type||"embed"===window.gameData.type)&&!window.gameData.api_enabled)if(document.querySelector('script[src="/assets/js/ads.general.min.js"]')||window.GeneralAdManager){if(window.GeneralAdManager){const t=e("#game-frame")[0];t&&window.GeneralAdManager.init(t)}}else{const t=document.createElement("script");t.src="/assets/js/ads.general.min.js",t.onload=function(){const t=e("#game-frame")[0];t&&window.GeneralAdManager&&window.GeneralAdManager.init(t)},t.onerror=function(){},document.head.appendChild(t)}},t.onerror=function(){},document.head.appendChild(t)}}(),k(),function(){if(!window.user&&!window.gameData.allowGuestRating||!window.gameData)return;e(".star-btn").off("click.rating"),e(".star-btn").on("click.rating",function(){const t=parseInt(e(this).data("rating"));e.ajax({url:"/requests/rate-game",method:"POST",data:{gameId:window.gameData.id,rating:t,userId:window.user?window.user.id:0},success:function(n){if(200===n.status){e(".star-btn").each(function(n){const a=e(this),o=a.find("i");n<t?(a.removeClass("text-gray-300 hover:text-yellow-300").addClass("text-yellow-400"),o.html('<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>')):(a.removeClass("text-yellow-400").addClass("text-gray-300 hover:text-yellow-300"),o.html('<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>'))});const a=parseFloat(n.data.gameRating).toFixed(1),o=n.data.totalRatings;e('span:contains("★")').each(function(){const t=e(this),n=t.text();n.includes("★")&&n.includes("rating")?t.text(`${a} ★ • ${o} rating${1!==o?"s":""}`):n.includes("★")&&t.text(`${a} ★`)}),window.gameData.userRating=t,window.gameData.gameRating=n.data.gameRating,window.gameData.totalRatings=n.data.totalRatings,alert.success(__("notifications.rating_submitted"))}else alert.danger(n.message||__("notifications.rating_failed"))},error:function(e){const t=e.responseJSON?.message||__("notifications.rating_submit_error");alert.danger(t)}})})}(),_(),M(),function(){if(!window.user||!window.gameData)return;e("#favorite-btn").off("click.favorite"),e("#favorite-btn").on("click.favorite",function(){const t=e(this);t.prop("disabled",!0).html('<svg class="w-4 h-4 mr-2 animate-pulse inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>'+__("notifications.processing")),e.ajax({url:"/requests/toggle-favorite",method:"POST",data:{gameId:window.gameData.id},success:function(e){200===e.status&&(e.data.favorited?(t.removeClass("bg-pink-500 hover:bg-pink-600").addClass("bg-red-500 hover:bg-red-600").html('<svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>'+__("games.unfavorite")),alert.success(__("api.requests.added_to_favorites"))):(t.removeClass("bg-red-500 hover:bg-red-600").addClass("bg-pink-500 hover:bg-pink-600").html('<svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>'+__("games.favorite")),alert.warning(__("api.requests.removed_from_favorites"))))},error:function(){alert.danger(__("notifications.favorite_update_failed"))},complete:function(){t.prop("disabled",!1)}})})}(),window.arcade&&window.arcade.websocket&&window.arcade.websocket.isConnected()&&window.arcade.websocket.gameStart({gameId:window.gameData.id,gameTitle:window.gameData.title,gameSlug:window.gameData.slug})):(k(),_(),M())},error:function(e){k(),_(),M()}})}function y(t,n){try{window.RufflePlayer=window.RufflePlayer||{},window.RufflePlayer.config={publicPath:"/assets/js/libs/ruffle/",allowScriptAccess:!1,autoplay:"on",splashScreen:!1,letterbox:"on",logLevel:"warn",contextMenu:"off",backgroundColor:"#000000",unmuteOverlay:"hidden",preferredRenderer:"webgl",openUrlMode:"deny"},t.empty();const a=window.RufflePlayer.newest().createPlayer();window.currentRufflePlayer=a,e(a).css({width:"100%",height:"100%",display:"block"}),t.append(a),a.load(n),window.FlashAdManager&&window.FlashAdManager.init(a),e(a).on("loadedmetadata",function(){}),e(a).on("error",function(e){t.html('<div class="text-center text-red-500 p-4">Failed to load Flash game</div>')})}catch(e){t.html('<div class="text-center text-red-500 p-4">Failed to initialize Flash emulator</div>')}}function k(){let t="default";function n(a){const o=e("#game-container"),r=o.closest("section"),s=r.find("aside"),i=(e("header"),r.next("section"));if(e("#mode-default, #mode-cinematic, #mode-fullscreen").removeClass("bg-white shadow-sm").addClass("hover:bg-white"),"default"===a){e("#mode-default").addClass("bg-white shadow-sm").removeClass("hover:bg-white"),o.removeClass("cinematic-mode fullscreen-mode").css({position:"relative",left:"auto",right:"auto",top:"auto",transform:"none",width:(window.gameData.width||800)+"px",height:(window.gameData.height||600)+"px","max-width":"100%","z-index":"auto",background:"#e5e7eb"}),o.find(".cinematic-close-btn").remove();o.find("#game-frame").css({"border-radius":"0.5rem"}),s.show(),i.show(),e("body").removeClass("overflow-hidden")}else if("cinematic"===a){if(e("#mode-cinematic").addClass("bg-white shadow-sm").removeClass("hover:bg-white"),s.hide(),i.hide(),o.addClass("cinematic-mode").removeClass("fullscreen-mode").css({position:"fixed",left:"0",right:"0",top:"50%",transform:"translateY(-50%)",width:"100vw",height:"75vh","max-width":"none","z-index":"40",background:"#000",margin:"0","border-radius":"0"}),!o.find(".cinematic-close-btn").length){const l=e('\n                        <button class="cinematic-close-btn absolute top-4 right-4 z-50 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-all duration-200 backdrop-blur-sm">\n                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>\n                            </svg>\n                        </button>\n                    ');o.append(l),l.off("click.cinematic").on("click.cinematic",function(){n("default")})}o.find("#game-frame").css({"border-radius":"0"}),e("body").addClass("overflow-hidden")}else if("fullscreen"===a){e("#mode-fullscreen").addClass("bg-white shadow-sm").removeClass("hover:bg-white");const d=o[0];function c(){o.addClass("fullscreen-mode").css({width:"100vw",height:"100vh",background:"#000"});o.find("#game-frame").css({"border-radius":"0"})}function u(){s.hide(),i.hide(),o.addClass("fullscreen-mode").removeClass("cinematic-mode").css({position:"fixed",left:"0",right:"0",top:"0",bottom:"0",width:"100vw",height:"100vh","max-width":"none","z-index":"50",background:"#000",margin:"0","border-radius":"0"});o.find("#game-frame").css({"border-radius":"0"}),e("body").addClass("overflow-hidden")}d.requestFullscreen?d.requestFullscreen().then(()=>{o.addClass("fullscreen-mode").css({width:"100vw",height:"100vh",background:"#000"});o.find("#game-frame, #emulator-iframe").css({"border-radius":"0"})}).catch(()=>{u()}):d.webkitRequestFullscreen?(d.webkitRequestFullscreen(),c()):d.msRequestFullscreen?(d.msRequestFullscreen(),c()):d.mozRequestFullScreen?(d.mozRequestFullScreen(),c()):u()}t=a}e("#mode-default, #mode-cinematic, #mode-fullscreen").off("click.viewmode"),e(document).off("keydown.playpage"),e("#mode-default").on("click.viewmode",function(){n("default")}),e("#mode-cinematic").on("click.viewmode",function(){n("cinematic")}),e("#mode-fullscreen").on("click.viewmode",function(){n("fullscreen")}),e(document).on("keydown.playpage",function(e){"Escape"!==e.key||"fullscreen"!==t&&"cinematic"!==t||n("default")}),e(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange msfullscreenchange",function(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||"fullscreen"===t&&n("default")})}function _(){const t=e("#comment-text"),n=e("#char-count"),a=e("#post-comment-btn");t.length&&t.off("input.comment"),a.length&&a.off("click.comment"),e("#load-more-comments").off("click.comment"),e(document).off("click.comment",".delete-comment-btn"),e("#load-more-comments").on("click.comment",function(){const t=e(this),n=parseInt(t.data("offset")),a=t.text();t.prop("disabled",!0).html('<svg class="w-4 h-4 animate-spin inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>'+__("notifications.loading")),e.ajax({url:"/requests/load-comments",method:"GET",data:{gameId:window.gameData.id,offset:n,limit:5},success:function(a){if(200===a.status&&a.data&&a.data.length>0){const o=e("#comments-list");a.data.forEach(t=>{const n=C(t,!1),a=e(n).hide();o.append(a),a.fadeIn(400)}),t.data("offset",n+5),a.data.length<5&&t.fadeOut(300)}else t.fadeOut(300,function(){e(this).after('<p class="text-center text-gray-500 text-sm mt-4">No more comments to load</p>')})},error:function(e){const t=e.responseJSON?.message||__("notifications.comment_load_failed");alert.danger(t)},complete:function(){t.prop("disabled",!1).html(a)}})}),window.user&&(t.on("input.comment",function(){const t=e(this).val().length;n.text(t),t>500?(n.addClass("text-red-500"),a.prop("disabled",!0).addClass("opacity-50")):(n.removeClass("text-red-500"),a.prop("disabled",!1).removeClass("opacity-50"))}),a.on("click.comment",function(){const o=t.val().trim();if(!o)return void alert.warning(__("games.enter_comment"));if(o.length>500)return void alert.danger(__("games.comment_too_long"));const r=a.text();a.prop("disabled",!0).text("Posting..."),e.ajax({url:"/requests/post-comment",method:"POST",data:{gameId:window.gameData.id,comment:o},success:function(a){if(200===a.status){const o=e("#comments-list .text-center");o.length>0&&o.remove();const r=C(a.data.comment,!0);e("#comments-list").prepend(r),window.gameData.commentCount++,e("#comment-count").text(window.gameData.commentCount),t.val(""),n.text("0"),alert.success(__("games.comment_posted"))}else alert.danger(a.message||__("notifications.comment_failed"))},error:function(e){const t=e.responseJSON?.message||__("notifications.comment_post_failed");alert.danger(t)},complete:function(){a.prop("disabled",!1).text(r)}})}),e(document).on("click.comment",".delete-comment-btn",function(){const t=e(this).data("comment-id"),n=e(this).closest(".comment-item"),a=window.__("games.delete_comment"),o=window.__("games.delete_comment_confirm"),r=window.__("games.confirm"),s=window.__("games.cancel");iziToast.question({title:a,message:o,position:"center",backgroundColor:"#EF4444",titleColor:"#fff",messageColor:"#fff",icon:!1,timeout:!1,close:!1,overlay:!0,buttons:[[`<button style="color: white;">${r}</button>`,function(a,o){a.hide({transitionOut:"fadeOut"},o,"button"),e.ajax({url:"/requests/delete-comment",method:"POST",data:{commentId:t},success:function(t){200===t.status?(n.fadeOut(300,function(){e(this).remove(),window.gameData.commentCount--,e("#comment-count").text(window.gameData.commentCount),0===e("#comments-list .comment-item").length&&e("#comments-list").html('\n                                                <div class="text-center py-8 text-gray-500">\n                                                    <svg class="w-16 h-16 mb-2 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>\n                                                    </svg>\n                                                    <p>\' + __(\'games.no_comments\') + \'</p>\n                                                </div>\n                                            ')}),alert.success(__("games.comment_deleted"))):alert.danger(t.message||window.__("games.delete_comment_failed"))},error:function(e){const t=e.responseJSON?.message||window.__("games.delete_comment_error");alert.danger(t)}})},!0],[`<button style="color: white;">${s}</button>`,function(e,t){e.hide({transitionOut:"fadeOut"},t,"button")}]]})}))}function C(e,t){const n=window.user&&window.user.id===e.user_id?`<button class="delete-comment-btn text-gray-400 hover:text-red-500 text-sm" data-comment-id="${e.id}">\n                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>\n                </svg>\n            </button>`:"",a=t?window.__("games.just_now"):new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return`\n            <div class="comment-item flex space-x-3">\n                <img src="${e.avatar||"https://www.gravatar.com/avatar/default?d=identicon&s=40"}" alt="${e.username}"\n                    class="w-10 h-10 rounded-full flex-shrink-0" />\n                <div class="flex-1">\n                    <div class="bg-gray-50 rounded-xl p-4">\n                        <div class="flex items-center justify-between mb-2">\n                            <div class="flex items-center space-x-2">\n                                <span class="font-medium text-gray-900">${e.username}</span>\n                                <span class="text-xs text-gray-500">${a}</span>\n                            </div>\n                            ${n}\n                        </div>\n                        <p class="text-gray-700 text-sm">${e.comment}</p>\n                    </div>\n                </div>\n            </div>\n        `}function M(){e("#share-btn").off("click.share"),e("#share-btn").on("click.share",function(){const t=window.location.href,n=window.gameData.title;navigator.share?navigator.share({title:n,text:`Play ${n} online for free!`,url:t}):navigator.clipboard.writeText(t).then(()=>{e(this).html('<svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>'+__("notifications.copied")).removeClass("bg-blue-500 hover:bg-blue-600").addClass("bg-green-500"),setTimeout(()=>{e(this).html('<svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>'+__("buttons.share")).removeClass("bg-green-500").addClass("bg-blue-500 hover:bg-blue-600")},2e3),alert.success(__("games.url_copied"))}).catch(()=>{alert.danger(__("games.copy_failed"))})})}function j(){if(!e("#leaderboard-container").length)return;const t=e("#game-container").data("game-id");t&&$(t)}function $(t){e.ajax({url:`/requests/score/leaderboard/${t}`,method:"GET",data:{limit:5},dataType:"json"}).done(function(e){200===e.status&&e.data&&e.data.leaderboard&&e.data.leaderboard.length>0?function(e){const t=document.getElementById("leaderboard-container"),n=window.user?.username;let a='<div class="space-y-3">';e.forEach((e,t)=>{const o=t+1,r=1===o?"🥇":2===o?"🥈":3===o?"🥉":`${o}.`,s=n&&e.username===n;a+=`\n                <div class="flex items-center justify-between py-2 px-3 ${s?"bg-gradient-to-r from-orange-100 to-yellow-100 dark:from-orange-900/30 dark:to-yellow-900/30 border border-orange-300 dark:border-orange-700":"bg-gray-50 dark:bg-gray-800"} rounded-lg transition-all duration-300 ${s?"shadow-md":""}">\n                    <div class="flex items-center space-x-3">\n                        <span class="text-sm font-bold min-w-[24px] ${s?"text-orange-600 dark:text-orange-400":"dark:text-gray-300"}">${r}</span>\n                        <a href="/profile/${e.username}" class="font-medium ${s?"text-orange-800 dark:text-orange-200":"text-gray-900 dark:text-gray-100"} text-sm hover:underline" system-nav>\n                            ${e.username}\n                            ${s?'<span class="text-xs ml-1">(You)</span>':""}\n                        </a>\n                    </div>\n                    <span class="font-semibold ${s?"text-orange-700 dark:text-orange-300":"text-orange-600 dark:text-orange-400"}">${e.high_score.toLocaleString()}</span>\n                </div>\n            `}),a+="</div>",t.innerHTML=a,window.pjax&&window.pjax.refresh(t)}(e.data.leaderboard):L()}).fail(function(e,t,n){L()})}function L(){document.getElementById("leaderboard-container").innerHTML='\n            <div class="text-center py-4 text-gray-500 dark:text-gray-400">\n                <svg class="w-12 h-12 mb-2 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 01-.982-3.172M9.497 14.25a7.454 7.454 0 00.981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 007.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.545.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 002.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.492a46.32 46.32 0 012.916.52 6.003 6.003 0 01-5.395 4.972m0 0a6.726 6.726 0 01-2.749 1.35m0 0a6.772 6.772 0 01-3.044 0"/>\n                </svg>\n                <p class="text-sm">No scores yet</p>\n                <p class="text-xs">Be the first to score!</p>\n            </div>\n        '}function D(){try{window.currentRufflePlayer&&("function"==typeof window.currentRufflePlayer.pause&&window.currentRufflePlayer.pause(),"function"==typeof window.currentRufflePlayer.stop&&window.currentRufflePlayer.stop(),"function"==typeof window.currentRufflePlayer.destroy&&window.currentRufflePlayer.destroy(),window.currentRufflePlayer=null,delete window.currentRufflePlayer),window.RufflePlayer&&(window.RufflePlayer=null,delete window.RufflePlayer);document.querySelectorAll('script[src*="ruffle"]').forEach(e=>{e.remove()});const t=e("#ruffle-player");t.length&&t.empty(),e("ruffle-player").each(function(){try{this.pause&&"function"==typeof this.pause&&this.pause(),e(this).remove()}catch(e){}}),e('[id*="ruffle"], [class*="ruffle"]').each(function(){try{this.pause&&"function"==typeof this.pause&&this.pause()}catch(e){}}),e("body").removeClass("overflow-hidden").css("overflow","")}catch(e){}}function T(e){f&&f.connected&&e&&f.emit("leave_game_page",e)}function E(t,n){e(`.game-thumbnail[data-game-id="${t}"]`).each(function(){const t=e(this);let a=t.find(".viewer-count-badge");if(n>0)if(0===a.length){const o=t.closest("section");let r="#ef4444";if(o.length>0){const e=o.find('[style*="background"]').first();if(e.length>0){const t=e.attr("style").match(/#[0-9a-fA-F]{6}/);t&&(r=t[0])}}a=e(`\n                        <div class="viewer-count-badge absolute top-2 right-2 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1 shadow-lg z-10" style="background-color: ${r};">\n                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>\n                            </svg>\n                            <span class="viewer-count">${n}</span>\n                        </div>\n                    `),t.append(a)}else a.find(".viewer-count").text(n);else a.length>0&&a.remove()})}window.arcade=window.arcade||{},window.arcade.websocket={send:function(e,t){return!(!f||!f.connected)&&(f.emit(e,t),!0)},isConnected:()=>f&&f.connected,reconnect:()=>{f&&f.disconnect(),setTimeout(()=>{window.user&&window.user.id&&h()},1e3)},gameStart:function(e){f&&f.connected&&f.emit("game:start",e)},gameFinish:function(e){f&&f.connected&&f.emit("game:finish",e)},joinRoom:function(e){f&&f.connected&&f.emit("join_room",e)},leaveRoom:function(e){f&&f.connected&&f.emit("leave_room",e)}},window.refreshLeaderboard=function(){const t=e("#game-container").data("game-id");t&&$(t)},window.showTemplateCompetitivePopup=function(e){if(e<1)return;const t=document.getElementById("competitive-login-popup");t&&t.remove();const n=document.createElement("div");n.id="competitive-login-popup",n.className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[10000] flex items-start sm:items-center justify-center p-4 animate-in fade-in duration-300 overflow-y-auto";const a=document.createElement("div");a.className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg dark:shadow-2xl border border-gray-100 dark:border-gray-700 overflow-hidden max-w-4xl w-full animate-in slide-in-from-bottom-8 duration-300 my-4 sm:my-8 max-h-screen sm:max-h-[90vh] overflow-y-auto",a.innerHTML=`\n            <style>\n                @keyframes pulse-score {\n                    0%, 100% { transform: scale(1); }\n                    50% { transform: scale(1.05); }\n                }\n                @keyframes trophy-bounce {\n                    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }\n                    40% { transform: translateY(-5px); }\n                    60% { transform: translateY(-3px); }\n                }\n                .score-pulse { animation: pulse-score 2s ease-in-out infinite; }\n                .trophy-bounce { animation: trophy-bounce 2s ease-in-out infinite; }\n                \n                /* Mobile scrolling improvements */\n                #competitive-login-popup {\n                    -webkit-overflow-scrolling: touch;\n                    scroll-behavior: smooth;\n                }\n                \n                /* Ensure content doesn't get cut off on very short screens */\n                @media (max-height: 600px) {\n                    .popup-content {\n                        padding-top: 1rem;\n                        padding-bottom: 1rem;\n                    }\n                }\n            </style>\n            \n            <div class="grid grid-cols-1 lg:grid-cols-2 min-h-[350px] sm:min-h-[400px] lg:min-h-[500px]">\n                \x3c!-- Left Column - Score Display --\x3e\n                <div class="p-4 sm:p-6 lg:p-8 flex flex-col justify-center relative">\n                    <button class="absolute top-4 right-4 w-8 h-8 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300 rounded-full flex items-center justify-center text-lg font-bold transition-all hover:scale-110" \n                            onclick="document.getElementById('competitive-login-popup').remove()">×</button>\n                    \n                    \x3c!-- Score Header --\x3e\n                    <div class="text-center mb-4 sm:mb-6 lg:mb-8">\n                        <div class="mx-auto h-10 w-10 sm:h-12 sm:w-12 lg:h-16 lg:w-16 flex items-center justify-center rounded-full bg-orange-100 dark:bg-orange-900/30 mb-3 sm:mb-4 trophy-bounce">\n                            <span class="text-orange-500 text-xl sm:text-2xl lg:text-3xl">🏆</span>\n                        </div>\n                        <h1 class="text-gray-600 dark:text-gray-200 text-lg sm:text-xl lg:text-2xl font-bold mb-2">${__("games.amazing_score")}</h1>\n                        <div class="text-2xl sm:text-3xl lg:text-4xl xl:text-5xl font-black text-orange-500 mb-2 score-pulse">\n                            ${e.toLocaleString()}\n                        </div>\n                        <p class="text-gray-500 dark:text-gray-400 text-xs sm:text-sm">\n                            ${__("games.join_competition")}\n                        </p>\n                    </div>\n\n                    \x3c!-- Login Form Section --\x3e\n                    <div class="space-y-3 sm:space-y-4 lg:space-y-6">\n                        <div class="text-center">\n                            <h3 class="text-base sm:text-lg lg:text-xl font-semibold text-gray-700 dark:text-gray-200 mb-2 sm:mb-3">${__("games.ready_to_compete")}</h3>\n                            <p class="text-gray-500 dark:text-gray-400 text-xs sm:text-sm leading-relaxed">\n                                ${__("games.login_to_compete")}\n                            </p>\n                        </div>\n\n                        \x3c!-- Action Buttons --\x3e\n                        <div class="space-y-2 sm:space-y-3">\n                            <button class="w-full bg-black dark:bg-gray-700 text-white py-2.5 sm:py-3 px-4 rounded-xl font-medium hover:bg-gray-800 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center text-sm sm:text-base" \n                                    onclick="document.getElementById('competitive-login-popup').remove(); if (window.pjax) { window.pjax.loadUrl('/login'); } else { window.location.href = '/login'; }">\n                                <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75"/>\n                                </svg>\n                                ${__("games.login_to_save_score")}\n                            </button>\n                            <button class="w-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 py-2.5 sm:py-3 px-4 rounded-xl font-medium hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-all duration-200 text-sm sm:text-base" \n                                    onclick="document.getElementById('competitive-login-popup').remove()">\n                                ${__("games.maybe_later")}\n                            </button>\n                        </div>\n\n                        <div class="text-center text-xs sm:text-sm text-gray-500 dark:text-gray-400">\n                            ${__("auth.no_account")} \n                            <a href="#" class="text-orange-500 hover:text-orange-600 font-medium transition-colors duration-200"\n                               onclick="event.preventDefault(); document.getElementById('competitive-login-popup').remove(); if (window.pjax) { window.pjax.loadUrl('/register'); } else { window.location.href = '/register'; }">\n                                ${__("auth.register")}\n                            </a>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Right Column - Visual --\x3e\n                <div class="bg-gradient-to-br from-orange-50 via-orange-100/30 to-amber-50 dark:from-gray-800 dark:via-gray-700/60 dark:to-gray-800 p-4 sm:p-6 lg:p-8 flex flex-col justify-center items-center text-center relative overflow-hidden">\n                    \x3c!-- Background decoration --\x3e\n                    <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,_rgba(251,191,36,0.1)_0%,_transparent_50%)] dark:bg-[radial-gradient(circle_at_30%_20%,_rgba(251,191,36,0.05)_0%,_transparent_50%)]"></div>\n                    <div class="absolute inset-0 bg-[radial-gradient(circle_at_70%_80%,_rgba(249,115,22,0.1)_0%,_transparent_50%)] dark:bg-[radial-gradient(circle_at_70%_80%,_rgba(249,115,22,0.05)_0%,_transparent_50%)]"></div>\n                    \n                    <div class="relative z-10 space-y-4 sm:space-y-6">\n                        \x3c!-- Gaming icons --\x3e\n                        <div class="flex justify-center space-x-2 sm:space-x-4 mb-4 sm:mb-6">\n                            <div class="w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 bg-white/80 dark:bg-gray-800/80 rounded-full flex items-center justify-center shadow-sm">\n                                <span class="text-orange-500 text-lg sm:text-xl lg:text-2xl">🎮</span>\n                            </div>\n                            <div class="w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 bg-white/80 dark:bg-gray-800/80 rounded-full flex items-center justify-center shadow-sm">\n                                <span class="text-orange-500 text-lg sm:text-xl lg:text-2xl">🏆</span>\n                            </div>\n                            <div class="w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 bg-white/80 dark:bg-gray-800/80 rounded-full flex items-center justify-center shadow-sm">\n                                <span class="text-orange-500 text-lg sm:text-xl lg:text-2xl">⭐</span>\n                            </div>\n                        </div>\n\n                        <div class="space-y-2 sm:space-y-3">\n                            <h2 class="text-xl sm:text-2xl lg:text-3xl font-black text-gray-800 dark:text-gray-100 leading-tight">\n                                ${__("games.join_the_competition")}\n                            </h2>\n                            <p class="text-gray-600 dark:text-gray-300 text-sm sm:text-base lg:text-lg leading-relaxed max-w-xs mx-auto">\n                                ${__("games.leaderboards_description")}\n                            </p>\n                        </div>\n\n                        \x3c!-- Features --\x3e\n                        <div class="space-y-4">\n                            <div class="flex items-start space-x-3">\n                                <div class="flex-shrink-0 w-8 h-8 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center">\n                                    <span class="text-orange-600 dark:text-orange-400 text-lg">🏅</span>\n                                </div>\n                                <div class="text-left">\n                                    <h3 class="font-medium text-gray-700 dark:text-gray-200 mb-1 text-sm">${__("games.global_leaderboards")}</h3>\n                                    <p class="text-xs text-gray-500 dark:text-gray-400">${__("games.leaderboards_description")}</p>\n                                </div>\n                            </div>\n\n                            <div class="flex items-start space-x-3">\n                                <div class="flex-shrink-0 w-8 h-8 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center">\n                                    <span class="text-orange-600 dark:text-orange-400 text-lg">💎</span>\n                                </div>\n                                <div class="text-left">\n                                    <h3 class="font-medium text-gray-700 dark:text-gray-200 mb-1 text-sm">${__("games.personal_records")}</h3>\n                                    <p class="text-xs text-gray-500 dark:text-gray-400">${__("games.personal_records_description")}</p>\n                                </div>\n                            </div>\n\n                            <div class="flex items-start space-x-3">\n                                <div class="flex-shrink-0 w-8 h-8 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center">\n                                    <span class="text-orange-600 dark:text-orange-400 text-lg">⚡</span>\n                                </div>\n                                <div class="text-left">\n                                    <h3 class="font-medium text-gray-700 dark:text-gray-200 mb-1 text-sm">${__("games.exp_achievements")}</h3>\n                                    <p class="text-xs text-gray-500 dark:text-gray-400">${__("games.exp_achievements_description")}</p>\n                                </div>\n                            </div>\n\n                            <div class="flex items-start space-x-3">\n                                <div class="flex-shrink-0 w-8 h-8 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center">\n                                    <span class="text-orange-600 dark:text-orange-400 text-lg">🎯</span>\n                                </div>\n                                <div class="text-left">\n                                    <h3 class="font-medium text-gray-700 dark:text-gray-200 mb-1 text-sm">${__("games.score_history")}</h3>\n                                    <p class="text-xs text-gray-500 dark:text-gray-400">${__("games.score_history_description")}</p>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Security Info --\x3e\n                        <div class="text-center text-xs text-gray-500 dark:text-gray-400 mt-4">\n                            <p class="mb-2">${__("games.safe_secure")}</p>\n                            <div class="flex justify-center space-x-3">\n                                <span class="flex items-center">\n                                    <svg class="w-3 h-3 mr-1 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.623 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z"/>\n                                    </svg>\n                                    ${__("games.protected")}\n                                </span>\n                                <span class="flex items-center">\n                                    <svg class="w-3 h-3 mr-1 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/>\n                                    </svg>\n                                    ${__("games.quick_setup")}\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,n.appendChild(a),document.body.appendChild(n),n.addEventListener("click",function(e){e.target===n&&n.remove()});const o=function(e){"Escape"===e.key&&(n.remove(),document.removeEventListener("keydown",o))};document.addEventListener("keydown",o)},window.generateTemplateFloatingChatHTML=function(e){const{chatText:t,virtualChatText:n,openFullChatroomText:a,connectToSeeMessagesText:o,joinFullChatExpText:r,typeMessageText:s,loginToJoinText:i,loginText:l,registerText:d,userAuthenticated:c}=e;let u="";return u=c?`\n                <div id="floatingChatInput">\n                    <div class="flex space-x-2">\n                        <input type="text" id="floatingMessageInput" placeholder="${s}" \n                               class="flex-1 px-3 py-2 border-2 border-purple-200/60 dark:border-purple-700/60 rounded-lg bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm\n                               focus:outline-none focus:ring-2 focus:ring-purple-400/50 focus:border-purple-400 dark:focus:border-purple-500 text-sm dark:text-gray-100\n                               placeholder-purple-400/70 dark:placeholder-purple-400/50 transition-all duration-300 shadow-sm hover:shadow-md\n                               max-sm:px-2 max-sm:py-1.5">\n                        <button onclick="window.floatingChat.sendMessage()" \n                                class="bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 \n                                text-white px-4 py-2 rounded-lg shadow-lg hover:shadow-xl \n                                transform hover:scale-[1.02] active:scale-[0.98] transition-all duration-200\n                                max-sm:px-3 max-sm:py-1.5 group">\n                            <svg class="w-4 h-4 max-sm:w-3.5 max-sm:h-3.5 group-hover:translate-x-0.5 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/>\n                            </svg>\n                        </button>\n                    </div>\n                </div>\n            `:`\n                <div class="text-center">\n                    <p class="text-sm text-purple-600/80 dark:text-purple-400/80 mb-3 max-sm:text-xs max-sm:mb-2">${i}</p>\n                    <div class="flex space-x-2">\n                        <a href="/login" class="flex-1 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800\n                           text-white py-2 px-3 rounded-lg text-sm font-medium text-center \n                           shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-200\n                           max-sm:py-1.5 max-sm:px-2 max-sm:text-xs">\n                            ${l}\n                        </a>\n                        <a href="/register" class="flex-1 border-2 border-purple-600/60 dark:border-purple-500/60 text-purple-700 dark:text-purple-300 bg-purple-50/50 dark:bg-purple-900/30\n                           py-2 px-3 rounded-lg text-sm font-medium text-center \n                           hover:bg-purple-100/70 dark:hover:bg-purple-800/50 hover:border-purple-600 dark:hover:border-purple-400 hover:shadow-lg transform hover:scale-[1.02] transition-all duration-200\n                           max-sm:py-1.5 max-sm:px-2 max-sm:text-xs">\n                            ${d}\n                        </a>\n                    </div>\n                </div>\n            `,`\n            \x3c!-- Floating Chat System --\x3e\n            <div id="floatingChatSystem" class="fixed bottom-6 right-6 z-40">\n                \x3c!-- Chat Button (collapsed state) --\x3e\n                <div id="floatingChatButton" class="relative">\n                    <button onclick="window.floatingChat.toggleChat()" \n                            class="flex items-center space-x-2 bg-gradient-to-r from-purple-600 to-purple-700 \n                            hover:from-purple-700 hover:to-purple-800 text-white px-4 py-3 rounded-full \n                            shadow-lg hover:shadow-xl shadow-purple-500/25 hover:shadow-purple-500/40\n                            transition-all duration-300 transform hover:scale-105 active:scale-95\n                            backdrop-blur-sm border border-white/20\n                            sm:px-4 sm:py-3 sm:space-x-2\n                            max-sm:px-3 max-sm:py-2 max-sm:space-x-1 group">\n                        <svg class="w-5 h-5 max-sm:w-4 max-sm:h-4 group-hover:scale-110 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>\n                        </svg>\n                        <span class="font-medium text-base max-sm:text-sm max-sm:hidden group-hover:text-purple-100 transition-colors duration-200">${t}</span>\n                        <span id="floatingPlayerCount" class="bg-white/25 backdrop-blur-sm text-xs px-2 py-1 rounded-full max-sm:px-1.5 max-sm:py-0.5 \n                              border border-white/20 group-hover:bg-white/30 transition-all duration-200">0</span>\n                        <span id="chatNotificationBadge" class="absolute -top-2 -right-2 bg-gradient-to-r from-red-500 to-pink-500 \n                              text-white text-xs w-5 h-5 rounded-full flex items-center justify-center \n                              hidden animate-bounce shadow-lg shadow-red-500/30\n                              max-sm:w-4 max-sm:h-4 max-sm:-top-1 max-sm:-right-1 border border-white/20">!</span>\n                    </button>\n                </div>\n\n                \x3c!-- Chat Window --\x3e\n                <div id="floatingChatWindow" class="hidden absolute \n                     bottom-0 right-0\n                     w-80 h-96 \n                     max-w-[calc(100vw-2rem)] \n                     bg-white/95 dark:bg-gray-800/95 backdrop-blur-md rounded-2xl shadow-2xl shadow-purple-500/20 dark:shadow-purple-400/10 \n                     border border-purple-200/60 dark:border-purple-700/60 flex flex-col\n                     transform-gpu animate-in slide-in-from-bottom-8 fade-in duration-300\n                     max-sm:w-72 max-sm:h-72 max-sm:bottom-12">\n                    \n                    \x3c!-- Chat Header --\x3e\n                    <div class="flex items-center justify-between p-4 border-b border-purple-200/50 dark:border-purple-700/50 \n                         bg-gradient-to-r from-purple-50/80 to-purple-100/60 dark:from-purple-900/40 dark:to-purple-800/40 backdrop-blur-sm rounded-t-2xl max-sm:p-3">\n                        <div class="flex items-center space-x-2">\n                            <div class="p-1.5 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full shadow-sm">\n                                <svg class="w-4 h-4 text-white max-sm:w-3.5 max-sm:h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>\n                                </svg>\n                            </div>\n                            <h3 class="font-semibold text-purple-800 dark:text-purple-200 text-base max-sm:text-sm">${n}</h3>\n                            <span id="windowPlayerCount" class="bg-gradient-to-r from-purple-600 to-purple-700 text-white text-xs px-2 py-1 \n                                  rounded-full shadow-sm border border-purple-300/30 max-sm:px-1.5 max-sm:py-0.5">0</span>\n                        </div>\n                        <div class="flex items-center space-x-2 max-sm:space-x-1">\n                            <a href="/chatroom" target="_blank" class="text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 p-2 \n                               hover:bg-purple-200/50 dark:hover:bg-purple-800/50 rounded-lg transition-all duration-300 group" title="${a}">\n                                <svg class="w-4 h-4 max-sm:w-3.5 max-sm:h-3.5 group-hover:scale-110 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"/>\n                                </svg>\n                            </a>\n                            <button onclick="window.floatingChat.toggleChat()" \n                                    class="text-purple-400 dark:text-purple-500 hover:text-purple-600 dark:hover:text-purple-300 p-2 hover:bg-purple-200/50 dark:hover:bg-purple-800/50 rounded-lg \n                                    transition-all duration-300 group">\n                                <svg class="w-4 h-4 max-sm:w-3.5 max-sm:h-3.5 group-hover:rotate-90 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>\n                                </svg>\n                            </button>\n                        </div>\n                    </div>\n\n                    \x3c!-- Chat Messages --\x3e\n                    <div id="floatingChatMessages" class="flex-1 overflow-y-auto p-4 space-y-2 max-sm:p-3 \n                         scrollbar-thin scrollbar-thumb-purple-300 dark:scrollbar-thumb-purple-600 scrollbar-track-purple-50 dark:scrollbar-track-purple-900">\n                        <div class="text-center text-purple-400 dark:text-purple-500 text-sm py-8">\n                            <div class="p-3 bg-gradient-to-br from-purple-100 to-purple-200 dark:from-purple-900/50 dark:to-purple-800/50 rounded-full w-16 h-16 mx-auto mb-4 \n                                 flex items-center justify-center shadow-sm border border-purple-200 dark:border-purple-700">\n                                <svg class="w-8 h-8 max-sm:w-6 max-sm:h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>\n                                </svg>\n                            </div>\n                            <p class="text-sm max-sm:text-xs font-medium text-purple-600 dark:text-purple-400 mb-1">${o}</p>\n                            <p class="text-xs text-purple-500/70 dark:text-purple-500/60">${r}</p>\n                        </div>\n                    </div>\n\n                    \x3c!-- Chat Input --\x3e\n                    <div class="p-4 border-t border-purple-200/50 dark:border-purple-700/50 bg-gradient-to-r from-purple-50/30 to-white/50 dark:from-purple-900/20 dark:to-gray-800/50 \n                         backdrop-blur-sm rounded-b-2xl max-sm:p-3">\n                        <div id="floatingChatInputContainer">\n                            ${u}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `},window.generateTemplateFloatingChatMessageHTML=function(e,t){return e.map((e,n)=>`\n            <div class="text-sm max-sm:text-xs hover:bg-gradient-to-r hover:from-purple-50/60 hover:to-purple-100/40 dark:hover:from-purple-900/30 dark:hover:to-purple-800/30 \n                 p-3 rounded-xl transition-all duration-300 hover:scale-[1.02] hover:shadow-sm\n                 border border-transparent hover:border-purple-200/40 dark:hover:border-purple-700/40 group animate-in slide-in-from-left-4"\n                 style="animation-delay: ${50*n}ms">\n                <span class="font-semibold bg-gradient-to-r from-purple-600 to-purple-700 bg-clip-text text-transparent \n                      group-hover:from-purple-700 group-hover:to-purple-800 transition-all duration-200">${t(e.name)}:</span>\n                <span class="text-gray-700 dark:text-gray-300 ml-1 group-hover:text-gray-800 dark:group-hover:text-gray-200 transition-colors duration-200">${t(e.message)}</span>\n            </div>\n        `).join("")};let B=null;function P(){B&&(T(B),B=null);const t=window.location.pathname.split("/");if("play"===t[1]&&t[2]){const t=e("#game-container").data("game-id")||window.gameData?.id;t&&(B=t,setTimeout(()=>{!function(e){f&&f.connected&&e&&f.emit("join_game_page",e)}(t)},1e3))}}P(),e(document).on("pjax:success",function(){P(),e('.ad-container[data-auto-init="true"]').each(function(){const t=e(this);if(!t.data("initialized")){const e=t.data("width")||320,n=t.data("height")||250,a=t.data("placement")||"sidebar";setTimeout(()=>{window.initAdContainer(this,e,n,a)},1e3*Math.random())}})}),e(window).on("beforeunload",function(){B&&T(B),D()}),window.testViewerCount=function(e,t){E(e,t)};let S=!1;function I(){if(window.user)return!1;if(!0===window.MAINTENANCE_MODE)return!1;const e=window.location.pathname,t=[/^\/play\//,/^\/auth\//,/^\/(login|register|forgot-password|reset-password|verify-email)/,/^\/errors?\//];for(const n of t)if(n.test(e))return!1;return!0}function z(){if(S||document.getElementById("promoModalStyles"))return;const e=document.createElement("style");e.id="promoModalStyles",e.textContent="\n            @keyframes fade-in {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            \n            @keyframes scale-in {\n                from { transform: scale(0.9); opacity: 0; }\n                to { transform: scale(1); opacity: 1; }\n            }\n            \n            @keyframes slide-up {\n                from { transform: translateY(20px); opacity: 0; }\n                to { transform: translateY(0); opacity: 1; }\n            }\n            \n            @keyframes slide-right {\n                from { transform: translateX(-20px); opacity: 0; }\n                to { transform: translateX(0); opacity: 1; }\n            }\n            \n            @keyframes float {\n                0%, 100% { transform: translateY(0px); }\n                50% { transform: translateY(-10px); }\n            }\n            \n            @keyframes bounce-slow {\n                0%, 100% { transform: translateY(0); }\n                50% { transform: translateY(-5px); }\n            }\n            \n            @keyframes pulse-slow {\n                0%, 100% { opacity: 0.7; }\n                50% { opacity: 0.9; }\n            }\n            \n            .promo-animate-fade-in { animation: fade-in 0.4s ease-out; }\n            .promo-animate-scale-in { animation: scale-in 0.5s ease-out; }\n            .promo-animate-slide-up { animation: slide-up 0.6s ease-out; }\n            .promo-animate-slide-right { animation: slide-right 0.6s ease-out; }\n            .promo-animate-float { animation: float 6s ease-in-out infinite; }\n            .promo-animate-bounce-slow { animation: bounce-slow 3s ease-in-out infinite; }\n            .promo-animate-pulse-slow { animation: pulse-slow 4s ease-in-out infinite; }\n            \n            .promo-animation-delay-200 { animation-delay: 0.2s; }\n            .promo-animation-delay-300 { animation-delay: 0.3s; }\n            .promo-animation-delay-400 { animation-delay: 0.4s; }\n            .promo-animation-delay-500 { animation-delay: 0.5s; }\n        ",document.head.appendChild(e),S=!0}function A(){if(document.getElementById("chatroomPromoModal"))return;if(!I())return;z();const e=document.createElement("div");e.id="chatroomPromoModal",e.className="fixed inset-0 z-50 promo-animate-fade-in",e.innerHTML=`\n            <div class="bg-black/70 backdrop-blur-md absolute inset-0 promo-animate-pulse-slow" onclick="this.parentElement.remove()"></div>\n            <div class="relative flex items-center justify-center min-h-screen p-4 overflow-y-auto">\n                <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl dark:shadow-2xl max-w-4xl w-full overflow-hidden transform promo-animate-scale-in my-8">\n                    <div class="flex flex-col lg:flex-row max-h-[90vh] overflow-y-auto">\n                        \x3c!-- Hero Image Side --\x3e\n                        <div class="lg:w-1/2 relative bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 p-6 lg:p-8 flex items-center justify-center bg-center bg-cover min-h-[300px] lg:min-h-[500px]" style="background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.05"%3E%3Cpath d="M10 10h40v40H10V10zm5 5v30h30V15H15zm5 5h20v20H20V20z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');">\n                            <div class="absolute inset-0 bg-gradient-to-br from-purple-600/90 via-blue-600/90 to-indigo-700/90"></div>\n                            <div class="relative z-10 text-center text-white">\n                                <div class="w-16 h-16 lg:w-24 lg:h-24 mx-auto mb-4 lg:mb-6 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center shadow-lg promo-animate-bounce-slow">\n                                    <svg class="w-10 h-10 lg:w-16 lg:h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>\n                                    </svg>\n                                </div>\n                                <h4 class="text-xl lg:text-2xl font-bold mb-2 lg:mb-3 promo-animate-slide-up">${__("promo.modal.virtual_chat")}</h4>\n                                <p class="text-purple-100 text-sm leading-relaxed promo-animate-slide-up promo-animation-delay-200">${__("promo.modal.chat_description")}</p>\n                                <div class="mt-4 lg:mt-6 grid grid-cols-2 gap-2 text-xs promo-animate-slide-up promo-animation-delay-400">\n                                    <div class="bg-white/20 backdrop-blur-sm rounded-lg px-2 py-2 flex items-center justify-center">\n                                        <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>\n                                        </svg>\n                                        <span>${__("promo.modal.character")}</span>\n                                    </div>\n                                    <div class="bg-white/20 backdrop-blur-sm rounded-lg px-2 py-2 flex items-center justify-center">\n                                        <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 01-.982-3.172M9.497 14.25a7.454 7.454 0 00.981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 007.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.545.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 002.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.492a46.32 46.32 0 012.916.52 6.003 6.003 0 01-5.395 4.972m0 0a6.726 6.726 0 01-2.749 1.35m0 0a6.772 6.772 0 01-3.044 0"/>\n                                        </svg>\n                                        <span>${__("promo.modal.earn_exp")}</span>\n                                    </div>\n                                    <div class="bg-white/20 backdrop-blur-sm rounded-lg px-2 py-2 flex items-center justify-center">\n                                        <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z"/>\n                                        </svg>\n                                        <span>${__("promo.modal.explore")}</span>\n                                    </div>\n                                    <div class="bg-white/20 backdrop-blur-sm rounded-lg px-2 py-2 flex items-center justify-center">\n                                        <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>\n                                        </svg>\n                                        <span>${__("promo.modal.make_friends")}</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Content Side --\x3e\n                        <div class="lg:w-1/2 p-4 lg:p-6 relative flex-1">\n                            <div class="absolute top-3 right-3">\n                                <button onclick="this.closest('#chatroomPromoModal').remove()" \n                                        class="text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 p-1.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200">\n                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>\n                                    </svg>\n                                </button>\n                            </div>\n                            \n                            <div class="promo-animate-slide-right">\n                                <h3 class="text-xl lg:text-2xl font-bold text-gray-900 dark:text-gray-100 mb-3">${__("promo.modal.join_community")}</h3>\n                                <p class="text-gray-600 dark:text-gray-300 mb-4 lg:mb-6 leading-relaxed text-sm">${__("promo.modal.community_description")}</p>\n                                \n                                <div class="space-y-3 mb-4 lg:mb-6">\n                                    <div class="bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg p-3 border border-purple-100 dark:border-purple-800 promo-animate-slide-right promo-animation-delay-200">\n                                        <div class="flex items-center space-x-3 text-purple-700 dark:text-purple-300">\n                                            <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center flex-shrink-0">\n                                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>\n                                                </svg>\n                                            </div>\n                                            <div>\n                                                <p class="font-semibold text-sm">${__("promo.modal.level_up_system")}</p>\n                                                <p class="text-xs text-purple-600 dark:text-purple-400">${__("promo.modal.level_up_description")}</p>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    \n                                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-3 border border-blue-100 dark:border-blue-800 promo-animate-slide-right promo-animation-delay-300">\n                                        <div class="flex items-center space-x-3 text-blue-700 dark:text-blue-300">\n                                            <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0">\n                                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"/>\n                                                </svg>\n                                            </div>\n                                            <div>\n                                                <p class="font-semibold text-sm">${__("promo.modal.interactive_world")}</p>\n                                                <p class="text-xs text-blue-600 dark:text-blue-400">${__("promo.modal.interactive_world_description")}</p>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    \n                                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg p-3 border border-green-100 dark:border-green-800 promo-animate-slide-right promo-animation-delay-400">\n                                        <div class="flex items-center space-x-3 text-green-700 dark:text-green-300">\n                                            <div class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center flex-shrink-0">\n                                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"/>\n                                                </svg>\n                                            </div>\n                                            <div>\n                                                <p class="font-semibold text-sm">${__("promo.modal.realtime_interaction")}</p>\n                                                <p class="text-xs text-green-600 dark:text-green-400">${__("promo.modal.realtime_interaction_description")}</p>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                \n                                <div class="flex space-x-2 promo-animate-slide-right promo-animation-delay-500">\n                                    <a href="/register" onclick="window.pjax.loadUrl('/register'); this.closest('#chatroomPromoModal').remove(); return false;" class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 text-white py-2.5 px-4 \n                                       rounded-lg font-semibold text-center hover:from-purple-700 hover:to-blue-700 \n                                       transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl text-sm">\n                                        <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.674-1.334c.343.061.676.133 1.001.207a3.978 3.978 0 01-.675 1.337z"/>\n                                        </svg>\n                                        ${__("promo.modal.join_now")}\n                                    </a>\n                                    <button onclick="this.closest('#chatroomPromoModal').remove()" \n                                            class="flex-1 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2.5 px-4 \n                                            rounded-lg font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 hover:border-gray-400 dark:hover:border-gray-500 \n                                            transition-all duration-300 transform hover:scale-105 text-sm">\n                                        ${__("promo.modal.later")}\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,document.body.appendChild(e)}function F(){const t=e("#sortDropdownBtn"),n=e("#sortDropdown"),a=e("#sortDropdownIcon");if(!t.length)return;t.off("click.gamesPage"),e(document).off("click.gamesPageDropdown keydown.gamesPageDropdown"),t.on("click.gamesPage",function(e){e.preventDefault(),e.stopPropagation(),n.toggleClass("hidden"),a.toggleClass("rotate-180")}),e(document).on("click.gamesPageDropdown",function(e){t.is(e.target)||n.is(e.target)||0!==n.has(e.target).length||(n.addClass("hidden"),a.removeClass("rotate-180"))}),e(document).on("keydown.gamesPageDropdown",function(e){"Escape"!==e.key||n.hasClass("hidden")||(n.addClass("hidden"),a.removeClass("rotate-180"))});const o=e("#tags-scroll"),r=e("#tags-left"),s=e("#tags-right");if(o.length){function i(){const e=o.scrollLeft(),t=o[0].scrollWidth-o.outerWidth();r.toggle(e>0),s.toggle(e<t)}r.off("click.gamesPage"),s.off("click.gamesPage"),o.off("scroll.gamesPage"),e(window).off("resize.gamesPage"),r.on("click.gamesPage",function(){o.animate({scrollLeft:o.scrollLeft()+-200},300)}),s.on("click.gamesPage",function(){o.animate({scrollLeft:o.scrollLeft()+200},300)}),o.on("scroll.gamesPage",i),i(),e(window).on("resize.gamesPage",i)}}function R(e){let t=e.parent(),n=!1;for(let e=0;e<5&&0!==t.length;e++){const e=t.attr("class")||"";if(e.includes("bg-gray-50")&&e.includes("border-")||e.includes("bg-gray-50")&&e.includes("py-")||e.includes("border-t")&&e.includes("py-")||e.includes("border-b")&&e.includes("py-")){n=!0;break}t=t.parent()}if(n&&t.length>0){const n=t.find(".ad-container"),a=n.not(e);if(n.length<=2&&(0===a.length||0===a.filter(":visible").length))return void t.remove()}e.remove()}function O(e){const t=e.find("button.bg-blue-50");if(t.length){const n=e.find(".overflow-y-auto")[0];if(n){const e=t[0].offsetTop,a=t[0].offsetHeight,o=n.clientHeight,r=n.scrollTop;(e<r||e+a>r+o)&&(n.scrollTop=e-o/2+a/2)}}}function q(e,t){"Enter"===e.key||" "===e.key?(e.preventDefault(),t.toggleClass("hidden"),t.hasClass("hidden")||(O(t),t.find('button[role="menuitem"]').first().focus())):"Escape"===e.key&&(e.preventDefault(),t.addClass("hidden"))}function N(){if(!e(".leaderboard-tab").length)return;let t="all-time";e(".leaderboard-tab").off("click.leaderboard"),e(".leaderboard-tab").on("click.leaderboard",function(){const n=e(this).data("period");n!==t&&(e(".leaderboard-tab").removeClass("bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border-blue-500 dark:border-blue-600").addClass("text-gray-500 dark:text-gray-400"),e(this).addClass("bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border-blue-500 dark:border-blue-600").removeClass("text-gray-500 dark:text-gray-400"),t=n,function(t){const n=e("#leaderboard-loading"),a=e("#leaderboard-content");n.removeClass("hidden"),a.addClass("hidden"),e.ajax({url:`/requests/leaderboard/${t}`,method:"GET",data:{limit:50},success:function(t){n.addClass("hidden"),200===t.status&&t.data&&t.data.leaderboard&&t.data.leaderboard.length>0?(!function(t){const n=e("#leaderboard-content .space-y-4");n.empty(),t.forEach((e,t)=>{const a=e.rank||t+1,o=a<=3,r=function(e){const t=e+1;return 0===e?'\n                    <div class="w-10 h-10 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg">\n                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">\n                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>\n                        </svg>\n                    </div>\n                ':1===e?'\n                    <div class="w-10 h-10 bg-gradient-to-br from-gray-300 to-gray-500 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg">\n                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">\n                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>\n                        </svg>\n                    </div>\n                ':2===e?'\n                    <div class="w-10 h-10 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg">\n                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">\n                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>\n                        </svg>\n                    </div>\n                ':`\n                    <div class="w-10 h-10 bg-gray-100 dark:bg-gray-600 rounded-full flex items-center justify-center text-gray-600 dark:text-gray-300 font-bold text-lg">\n                        #${t}\n                    </div>\n                `}(a-1),s=`\n                    <div class="flex items-center space-x-4 p-4 rounded-xl bg-white dark:bg-gray-800 border border-gray-200/50 dark:border-gray-700/50 hover:shadow-md dark:hover:shadow-lg transition-all duration-200 ${o?"ring-2 ring-yellow-200 dark:ring-yellow-400/50 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20":""}">\n                        \x3c!-- Rank --\x3e\n                        <div class="flex-shrink-0 text-center">\n                            ${r}\n                        </div>\n\n                        \x3c!-- Player Avatar --\x3e\n                        <div class="flex-shrink-0">\n                            <img src="${e.avatarUrl}" alt="${e.displayName}" class="w-14 h-14 rounded-full border-2 border-gray-200 dark:border-gray-600 object-cover">\n                        </div>\n\n                        \x3c!-- Player Info --\x3e\n                        <div class="flex-1 min-w-0">\n                            <div class="flex items-center space-x-2">\n                                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 truncate">${e.displayName}</h3>\n                                <span class="text-sm text-gray-500 dark:text-gray-400">@${e.username}</span>\n                            </div>\n                            <div class="flex items-center space-x-4 mt-1 text-sm text-gray-600 dark:text-gray-300">\n                                <span>${__("leaderboard.level")}: <strong>${parseInt(e.level||1).toLocaleString()}</strong></span>\n                                <span>${__("leaderboard.current_exp")}: <strong>${parseInt(e.exp_points||0).toLocaleString()}</strong></span>\n                            </div>\n                        </div>\n\n                        \x3c!-- Total EXP --\x3e\n                        <div class="flex-shrink-0 text-right">\n                            <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">${parseInt(e.total_exp_earned||0).toLocaleString()}</div>\n                            <div class="text-sm text-gray-500 dark:text-gray-400">${__("leaderboard.total_exp")}</div>\n                        </div>\n                    </div>\n                `;n.append(s)})}(t.data.leaderboard),a.removeClass("hidden")):(!function(){const t=e("#leaderboard-content .space-y-4");t.empty();const n=`\n                <div class="text-center py-12">\n                    <div class="inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4">\n                        <svg class="w-8 h-8 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>\n                        </svg>\n                    </div>\n                    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-2">${__("leaderboard.no_players")}</h3>\n                    <p class="text-gray-500 dark:text-gray-400">${__("leaderboard.no_players_desc")}</p>\n                </div>\n            `;t.append(n)}(),a.removeClass("hidden"))},error:function(e,t,o){n.addClass("hidden"),a.removeClass("hidden"),alert.danger(__("leaderboard.load_error"))}})}(n))})}window.initAdContainer=async function(t,n=320,a=250,o="sidebar"){const r=e(t);if(r.data("initialized"))return;r.data("initialized",!0),r.removeClass("hidden");const s=r.find(".ad-loading"),i=r.find(".ad-content"),l=r.find(".ad-fallback");s.removeClass("hidden"),i.addClass("hidden"),l.addClass("hidden");try{const t=await e.ajax({url:`/requests/banner-ad?width=${n}&height=${a}&placement=${o}`,method:"GET",dataType:"json"});200===t.status&&t.data&&t.data.ad_code?(s.addClass("hidden"),i.removeClass("hidden").html(t.data.ad_code),r.css({width:n+"px",height:a+"px","min-height":a+"px"})):R(r)}catch(e){R(r)}},e(document).ready(function(){e('.ad-container[data-auto-init="true"]').each(function(){const t=this;setTimeout(()=>{const n=e(t).data("width")||320,a=e(t).data("height")||250,o=e(t).data("placement")||"sidebar";window.initAdContainer(t,n,a,o)},2e3*Math.random())})}),window.changeLanguage=function(t){const n=e("#languageDropdownBtn"),a=n.find("span").text();n.find("span").text(__("notifications.loading")),e.post("/languages/change",{language:t}).done(function(e){200===e.status?alert.success(e.message||__("notifications.success"),!0):(alert.danger(e.message||__("notifications.error")),n.find("span").text(a))}).fail(function(e){let t=__("notifications.network_error");try{t=JSON.parse(e.responseText).message||t}catch(e){}alert.danger(t),n.find("span").text(a)})}}(jQuery);