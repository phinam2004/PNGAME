!function(t){"use strict";window.system={tables:function(e=!1){if(e&&window.table)table.refetchTable();else{const e=t("[system-table]").attr("system-table");e&&(window.table=new TableHandler({tableSelector:"#systemTable",paginationSelector:"#systemPagination",searchSelector:"#systemSearchInput",rowsPerPageSelector:"#systemRowsPerPage",fetchUrl:`/tables/${e}`}))}},loader:function(e,s=!0,o="body"){const n=t(o);s?n.loading({stoppable:!1,zIndex:1100,message:this._createLoaderHTML(e)}):n.loading("stop")},_createLoaderHTML:function(t){return`\n                <div class="flex flex-col items-center justify-center space-y-4">\n                    <div class="relative">\n                        <div class="w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>\n                        <div class="absolute top-0 left-0 w-12 h-12 border-4 border-transparent border-t-blue-400 rounded-full animate-ping"></div>\n                    </div>\n                    <div class="text-center">\n                        <div class="text-lg font-semibold text-gray-700">${t}</div>\n                        <div class="text-sm text-gray-500">${__("notifications.please_wait")}</div>\n                    </div>\n                </div>\n            `},actions:function(){t(document).on("click","[system-action]",function(e){e.preventDefault();const s=t(this).attr("system-action");system._handleAction(s)})},_handleAction:function(e){const s={logout:function(){t.get("/auth/logout").done(function(t){const e=system._parseResponse(t);200===e.status?alert.success(e.message,!0):location.reload()}).fail(function(){alert.danger(__("notifications.error"))})}};s[e]?s[e]():alert.danger(__("errors.invalid_request"))},disabled:function(e=!0){const s=t(".form-control, .input, button[type=submit]");e?s.attr("disabled",""):s.removeAttr("disabled")},redirect:function(t){window.location.href=t},delete:function(){t(document).on("click","[system-delete]",function(e){e.preventDefault();const s=t(this).attr("system-delete");s&&system._showDeleteConfirmation(s)})},_showDeleteConfirmation:function(t){iziToast.question({title:__("forms.delete"),message:__("notifications.delete_confirm"),titleLineHeight:"25px",backgroundColor:"#E82753",position:"center",icon:!1,drag:!1,timeout:!1,close:!1,overlay:!0,layout:1,zindex:1024,buttons:[['<button style="color: white !important;">'+__("notifications.confirm")+"</button>",function(e,s){system._executeDelete(t,e,s)},!0],['<button style="color: white !important;">'+__("notifications.cancel")+"</button>",function(t,e){t.hide({transitionOut:"fadeOut"},e,"button")}]]})},_executeDelete:function(e,s,o){s.hide({transitionOut:"fadeOut"},o,"button"),system.loader(__("notifications.processing_request")),t.ajax({url:`/requests/delete/${e}`,type:"GET",success:function(t){system.loader(!1,!1);const e=system._parseResponse(t);system._handleDeleteResponse(e)},error:function(){system.loader(!1,!1),alert.danger(__("notifications.error"))}})},_handleDeleteResponse:function(t){switch(t.status){case 200:window.table&&table.refetchTable(),alert.success(t.message);break;case 302:alert.warning(__("notifications.session_expired"),!0);break;default:alert.danger(t.message)}},modals:function(){this._createModalContainer(),this._bindModalEvents()},_createModalContainer:function(){t("#systemModalContainer").length||t("body").append('\n                <div id="systemModalContainer" class="fixed inset-0 z-[1099] flex items-start justify-center bg-black/50 backdrop-blur-sm p-4" style="display: none;">\n                    <div id="systemModalDialog" class="w-full max-w-lg mx-auto transition-all duration-300 transform -translate-y-12 opacity-0">\n                        <div id="systemModalContent" class="bg-white rounded-2xl shadow-2xl">\n                            \x3c!-- Modal content will be injected here --\x3e\n                        </div>\n                    </div>\n                </div>\n            ')},_bindModalEvents:function(){t(document).on("click","[system-toggle]",function(e){e.preventDefault(),topbar.show();const s=t(this).attr("system-toggle");s&&system._loadModal(s)}),t(document).on("click",".modal-close",function(t){system.hideModal()}),t(document).on("click","#systemModalContent button[type='button']",function(e){const s=t(this);s.closest(".ql-toolbar").length||(s.find("svg").length||s.hasClass("text-gray-400")||""===s.text().trim())&&(e.preventDefault(),system.hideModal())}),t(document).on("keydown",function(e){"Escape"===e.key&&t("#systemModalContainer").is(":visible")&&system.hideModal()})},_loadModal:function(e){t.get(`/widgets/${e}?_=${Date.now()}`).done(function(t){system.loader(!1,!1);const e=system._parseResponse(t);system._handleModalResponse(e),topbar.hide()}).fail(function(){system.loader(!1,!1),alert.danger(__("notifications.error")),topbar.hide()})},_handleModalResponse:function(t){switch(t.status){case 200:this._setupModal(t),this.showModal(),t.data.vars.type&&this._bindModalForm(t);break;case 302:alert.warning(__("notifications.session_expired"),!0);break;default:alert.danger(t.message)}},_setupModal:function(e){const s=t("#systemModalDialog");s.removeClass("max-w-sm max-w-lg max-w-xl max-w-2xl max-w-4xl");const o=e.data.vars.size||"xl";s.addClass(`${{sm:"max-w-sm",md:"max-w-lg",lg:"max-w-xl",xl:"max-w-2xl",xxl:"max-w-4xl"}[o]}`),t("#systemModalBody").remove(),t("#systemModalContent").html(e.data.tpl)},_bindModalForm:function(e){t("#systemModalContent [system-form]").off("submit").on("submit",function(t){t.preventDefault(),system._submitModalForm(this,e)})},_submitModalForm:function(e,s){const o=new FormData(e);t(e).find('input[type="checkbox"]').each(function(){const e=t(this),s=e.attr("name");s&&!e.is(":checked")&&o.append(s,"0")}),s.data.vars.id&&o.append("id",s.data.vars.id),this._validateModalForm(o,s.data.vars.require)&&(system.disabled(),s.data.vars.loader&&system.loader(s.data.vars.loader),t.ajax({url:`/requests/${s.data.vars.type}/${s.data.vars.tpl}`,type:"POST",data:o,contentType:!1,processData:!1,success:function(t){system._handleFormResponse(t,s.data.vars.loader)},error:function(){system.disabled(!1),s.data.vars.loader&&system.loader(!1,!1),alert.danger(__("notifications.error"))}}))},_validateModalForm:function(t,e){if(!e)return!0;const s=e.split("<=>");for(const e of s){if(!e)continue;const[s,o]=e.split("|");try{if(t.get(s)?.length<1)return alert.warning(__("forms.field_required",{field:o})),!1}catch(e){if(t.getAll(`${s}[]`)?.length<1)return alert.warning(__("forms.field_required",{field:o})),!1}}return!0},_handleFormResponse:function(t,e){const s=()=>{const e=system._parseResponse(t);system._processFormResult(e)};e?setTimeout(()=>{system.loader(!1,!1),s()},1e3):s(),system.disabled(!1)},_processFormResult:function(e){const s={200:()=>{window.table&&table.refetchTable(),t("#rebuildAssetsBtn").length&&pjax.loadUrl("/dashboard/templates"),system.hideModal(),alert.success(e.message)},301:()=>{system.hideModal(),alert.success(e.message,!0)},302:()=>{system.hideModal(),alert.warning(__("notifications.session_expired"),!0)},303:()=>{system.hideModal(),alert.warning(e.message),setTimeout(()=>system.redirect(e.data),3e3)},304:()=>{system.hideModal(),alert.success(e.message),setTimeout(()=>system.redirect(e.data),5e3)}};s[e.status]?s[e.status]():alert.danger(e.message)},showModal:function(){const e=t("#systemModalContainer"),s=t("#systemModalDialog");e.fadeIn(200,function(){s.css({transform:"translateY(0)",opacity:"1"}),t(document).trigger("system:modal:opened",{modalContainer:e,modalDialog:s,modalContent:t("#systemModalContent")})})},hideModal:function(){const e=t("#systemModalContainer");t("#systemModalDialog").css({transform:"translateY(-50px)",opacity:"0"}),setTimeout(()=>e.fadeOut(200),300)},_parseResponse:function(t){try{return"string"==typeof t?JSON.parse(t):t}catch(t){return{status:500,message:__("errors.invalid_response_format")}}}},window.alert={setup:function(){iziToast.settings({title:__("notifications.attention"),titleSize:"18px",titleLineHeight:"25px",messageSize:"17px",messageLineHeight:"20px",icon:!1,timeout:3e3,animateInside:!0,titleColor:"#f5f5f5",messageColor:"#f5f5f5",iconColor:"#f5f5f5",transitionIn:"fadeInRight",transitionOut:"fadeOutRight",position:"topLeft",displayMode:"replace",layout:2,maxWidth:"300px",close:!1})},primary:function(t,e=!1,s=!1,o=!1,n=!1,a=!1){this._showNotification("info",t,"#465fff",e,s,o,n,a)},success:function(t,e=!1,s=!1,o=!1,n=!1,a=!1){this._showNotification("success",t,"#00c52c",e,s,o,n,a)},warning:function(t,e=!1,s=!1,o=!1,n=!1,a=!1){this._showNotification("warning",t,"#FE9431",e,s,o,n,a)},danger:function(t,e=!1,s=!1,o=!1,n=!1,a=!1){this._showNotification("error",t,"#E82753",e,s,o,n,a)},_showNotification:function(t,e,s,o,n,a,i,l){const r={backgroundColor:s,message:e,onClosed:()=>{o&&location.reload()}};n&&Object.assign(r,{title:a||!1,displayMode:0,image:l||!1,imageWidth:l?85:void 0,timeout:!i&&3e3,close:i||!1,maxWidth:i?"600px":"300px",position:"bottomLeft"}),iziToast[t](r)}}}(jQuery);