!function(e){"use strict";function t(){if("/dashboard/importer"!==window.location.pathname)return;const t={currentPage:1,itemsPerPage:16,totalPages:1,totalCount:0,isLoading:!1,filters:{search:"",category:""}},a={searchInput:e("#searchInput"),categoryFilter:e("#categoryFilter"),applyFilters:e("#applyFilters"),clearFilters:e("#clearFilters"),refreshGames:e("#refreshGames"),itemsPerPage:e("#itemsPerPage"),gamesContainer:e("#gamesContainer"),loadingState:e("#loadingState"),gamesGrid:e("#gamesGrid"),emptyState:e("#emptyState"),errorState:e("#errorState"),errorMessage:e("#errorMessage"),retryConnection:e("#retryConnection"),paginationContainer:e("#paginationContainer"),paginationNav:e("#paginationNav"),currentPageInfo:e("#currentPageInfo"),totalPagesInfo:e("#totalPagesInfo"),resultsCount:e("#resultsCount"),apiStatus:e("#apiStatus"),statusDot:e("#statusDot"),statusText:e("#statusText")};function r(){t.filters.search=a.searchInput.val().trim(),t.filters.category=a.categoryFilter.val(),t.currentPage=1,l()}function n(){a.searchInput.val(""),a.categoryFilter.val(""),t.filters={search:"",category:""},t.currentPage=1,l()}function o(){t.currentPage=1,l()}function i(){t.itemsPerPage=parseInt(a.itemsPerPage.val()),t.currentPage=1,l()}function s(e,t){a.statusDot.removeClass("bg-green-400 bg-red-400 bg-yellow-400 bg-gray-400").addClass({connected:"bg-green-400",error:"bg-red-400",loading:"bg-yellow-400"}[e]||"bg-gray-400"),a.statusText.text(t)}function g(e){switch(a.loadingState.hide(),a.gamesGrid.hide(),a.emptyState.hide(),a.errorState.hide(),a.paginationContainer.hide(),e){case"loading":a.loadingState.show();break;case"games":a.gamesGrid.show(),a.paginationContainer.show();break;case"empty":a.emptyState.show();break;case"error":a.errorState.show()}}function l(r=null){if(t.isLoading)return;null!==r&&(t.currentPage=r),t.isLoading=!0,g("loading"),s("loading",__("dashboard.importer.connecting"));const n=new URLSearchParams({page:t.currentPage,limit:t.itemsPerPage});t.filters.search&&n.append("search",t.filters.search),t.filters.category&&n.append("category",t.filters.category);const o=`/requests/importer?${n.toString()}`;e.ajax({url:o,method:"GET",timeout:1e4,success:function(r){t.isLoading=!1,200===r.status&&r.data?(s("connected",__("dashboard.importer.api_connected")),function(r){const{games:n,pagination:o}=r;if(!n||0===n.length)return g("empty"),void d(0,0,0);t.currentPage=o.current_page,t.totalPages=o.total_pages,t.totalCount=o.total_count,function(t){a.gamesGrid.empty(),window.importerGameData=window.importerGameData||{},t.forEach(t=>{window.importerGameData[t.id]=t;const r=function(t){const a=t.thumbnail||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0ibTEyIDJsMyA3aDdhMSAxIDAgMCAxIC41OSAxLjVsLTYgNC40YTEgMSAwIDAgMC0uMzYgMS4xbDMgNmExIDEgMCAwIDEtMS41MyAxLjE1TDEyIDEyIDYuNSAyMi4xYTEgMSAwIDAgMS0xLjUzLTEuMTVsMy02YTEgMSAwIDAgMC0uMzYtMS4xbC02LTQuNGExIDEgMCAwIDEgLjU5LTEuNWg3eiIgZmlsbD0iI2ZmZDcwMCIgc3Ryb2tlPSIjZmZkNzAwIiBzdHJva2Utd2lkdGg9IjEuNSIvPgo8L3N2Zz4K",r=t.game_file;return e(`\n                <div class="relative bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-lg transition-all duration-300 group">\n                    \x3c!-- Game Thumbnail --\x3e\n                    <div class="relative aspect-square bg-gradient-to-br from-gray-100 to-gray-200">\n                        <img src="${a}" alt="${p(t.title)}" \n                             class="w-full h-full object-cover group-hover:scale-105 transition-all duration-300 ${t.thumbnail?"":"opacity-20"}"\n                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0ibTEyIDJsMyA3aDdhMSAxIDAgMCAxIC41OSAxLjVsLTYgNC40YTEgMSAwIDAgMC0uMzYgMS4xbDMgNmExIDEgMCAwIDEtMS41MyAxLjE1TDEyIDEyIDYuNSAyMi4xYTEgMSAwIDAgMS0xLjUzLTEuMTVsMy02YTEgMSAwIDAgMC0uMzYtMS4xbC02LTQuNGExIDEgMCAwIDEgLjU5LTEuNWg3eiIgZmlsbD0iI2ZmZDcwMCIgc3Ryb2tlPSIjZmZkNzAwIiBzdHJva2Utd2lkdGg9IjEuNSIvPgo8L3N2Zz4K'; this.className='w-full h-full object-cover opacity-20';">\n                        \n                        \x3c!-- Hover overlay for darkening effect --\x3e\n                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-300"></div>\n                        \n                        \x3c!-- Import Button in Corner --\x3e\n                        <button class="import-game-btn absolute top-2 right-2 bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-700 hover:to-cyan-700 text-white p-2 rounded-lg transition-all duration-200 hover:shadow-lg hover:scale-110 opacity-95 hover:opacity-100 group-hover:opacity-100" \n                                data-game-id="${t.id}" \n                                data-game-title="${p(t.title)}"\n                                data-download-url="${r}"\n                                title="Import ${p(t.title)}">\n                            <span class="btn-icon">\n                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>\n                                </svg>\n                            </span>\n                            <span class="btn-loading hidden">\n                                <svg class="animate-spin w-4 h-4 text-white" fill="none" viewBox="0 0 24 24">\n                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n                                    <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 0 14 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n                                </svg>\n                            </span>\n                        </button>\n                        \n                        \x3c!-- Game Type Badge --\x3e\n                        <div class="absolute top-2 left-2">\n                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${"rom"===t.game_type?"bg-purple-100 text-purple-800":"html5"===t.game_type?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}">\n                                ${"rom"===t.game_type?"ROM":"html5"===t.game_type?"HTML5":"flash"===t.game_type?"Flash":t.game_type.toUpperCase()}\n                            </span>\n                        </div>\n                        \n                        \x3c!-- Game Title Overlay --\x3e\n                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-3">\n                            <h3 class="text-white font-medium text-sm line-clamp-2">${p(t.title)}</h3>\n                        </div>\n                    </div>\n                </div>\n            `)}(t);a.gamesGrid.append(r)})}(n),function(t){const r=a.paginationNav;if(r.empty(),t.total_pages<=1)return void a.paginationContainer.hide();t.has_prev_page&&r.append(`\n                    <button class="pagination-btn px-3 py-2 text-sm text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50" data-page="${t.prev_page}">\n                        ${__("dashboard.importer.previous")}\n                    </button>\n                `);const n=Math.max(1,t.current_page-2),o=Math.min(t.total_pages,t.current_page+2);n>1&&(r.append('<button class="pagination-btn px-3 py-2 text-sm text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50" data-page="1">1</button>'),n>2&&r.append('<span class="px-2 text-gray-500">...</span>'));for(let e=n;e<=o;e++){const a=e===t.current_page;r.append(`\n                    <button class="pagination-btn px-3 py-2 text-sm ${a?"text-white bg-teal-600 border-teal-600":"text-gray-500 bg-white border-gray-300 hover:bg-gray-50"} border rounded-lg" data-page="${e}">\n                        ${e}\n                    </button>\n                `)}o<t.total_pages&&(o<t.total_pages-1&&r.append('<span class="px-2 text-gray-500">...</span>'),r.append(`<button class="pagination-btn px-3 py-2 text-sm text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50" data-page="${t.total_pages}">${t.total_pages}</button>`));t.has_next_page&&r.append(`\n                    <button class="pagination-btn px-3 py-2 text-sm text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50" data-page="${t.next_page}">\n                        ${__("dashboard.importer.next")}\n                    </button>\n                `);r.find(".pagination-btn").on("click",function(){l(parseInt(e(this).data("page")))}),a.currentPageInfo.text(t.current_page),a.totalPagesInfo.text(t.total_pages)}(o),d(n.length,t.totalCount,t.currentPage),g("games")}(r.data)):(s("error",__("dashboard.importer.api_error")),c(r.message||__("dashboard.importer.invalid_api_response")))},error:function(e,a,r){t.isLoading=!1,s("error",__("dashboard.importer.connection_failed"));let n=__("dashboard.importer.api_connection_failed");"timeout"===a?n=__("dashboard.importer.request_timeout"):e.responseJSON&&e.responseJSON.message&&(n=e.responseJSON.message),c(n)}})}function d(e,t,r){a.resultsCount.text(t.toLocaleString())}function c(e){a.errorMessage.text(e),g("error")}function p(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}function u(e){e.removeClass("importing").prop("disabled",!1),e.find(".btn-loading").hide(),e.find(".btn-icon").html('\n                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>\n                </svg>\n            ').show()}0!==a.gamesContainer.length&&(!function(){let s;a.applyFilters.on("click",r),a.clearFilters.on("click",n),a.refreshGames.on("click",o),a.retryConnection.on("click",o),a.itemsPerPage.on("change",i),a.searchInput.on("input",function(){clearTimeout(s),s=setTimeout(()=>{t.filters.search=e(this).val().trim(),""!==t.filters.search&&l(1)},500)}),a.searchInput.on("keypress",function(e){13===e.which&&(e.preventDefault(),r())})}(),l(),a.gamesContainer.on("click",".import-game-btn",function(){const t=e(this),a=t.data("game-id"),r=t.data("game-title"),n=(t.data("download-url"),window.importerGameData&&window.importerGameData[a]);n?t.hasClass("importing")||(t.addClass("importing").prop("disabled",!0),t.find(".btn-icon").hide(),t.find(".btn-loading").show(),e.ajax({url:"/requests/import-game",method:"POST",data:JSON.stringify(n),contentType:"application/json",timeout:6e4,success:function(e){200===e.status?(alert.success(__("dashboard.importer.import_success",{title:r})),t.removeClass("importing").addClass("imported").removeClass("from-teal-600 to-cyan-600 hover:from-teal-700 hover:to-cyan-700").addClass("from-green-600 to-emerald-600").prop("disabled",!0),t.find(".btn-loading").hide(),t.find(".btn-icon").html('\n                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>\n                            </svg>\n                        ').show()):(alert.danger(e.message||__("dashboard.importer.import_failed")),u(t))},error:function(e,a,r){let n=__("dashboard.importer.import_error");if("timeout"===a)n=__("dashboard.importer.import_timeout");else if(e.responseJSON&&e.responseJSON.message)n=e.responseJSON.message;else if(e.responseText)try{n=JSON.parse(e.responseText).message||n}catch(e){}alert.danger(n),u(t)}})):alert.danger(__("dashboard.importer.game_data_not_found"))}))}e(function(){t()}),e(document).on("pjax:complete",function(){t()}),window.importerUtils={initImporter:t}}(jQuery);