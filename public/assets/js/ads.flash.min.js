!function(t){"use strict";window.FlashAdManager={player:null,adContainer:null,isPlaying:!1,lastAdTime:0,adCooldown:18e4,init:function(t){this.player=t,this.createAdContainer(),this.setupEventListeners(),setTimeout(()=>{this.showPrerollAd()},2e3)},createAdContainer:function(){const e=t(this.player).closest("#game-container");this.adContainer=t('\n                <div id="flash-ad-overlay" class="\n                    absolute inset-0 w-full h-full \n                    bg-black/80 dark:bg-black/90 backdrop-blur-sm\n                    hidden z-50 flex items-center justify-center flex-col\n                    transition-all duration-300 ease-in-out\n                ">\n                    <div id="flash-ad-content" class="\n                        bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100\n                        rounded-xl shadow-2xl p-4 text-center relative\n                        inline-block max-w-4xl max-h-96\n                        border border-gray-200 dark:border-gray-700 backdrop-blur-lg\n                        transform scale-95 transition-transform duration-300\n                        overflow-hidden\n                    ">\n                        <button id="flash-ad-close" class="\n                            absolute top-2 right-2 w-8 h-8\n                            bg-gray-900 dark:bg-gray-700 hover:bg-red-600 dark:hover:bg-red-500 \n                            text-white border-2 border-white dark:border-gray-300 \n                            rounded-full cursor-pointer text-sm leading-none z-10\n                            flex items-center justify-center\n                            transition-all duration-200 hover:scale-110\n                            shadow-lg hover:shadow-xl\n                        ">&times;</button>\n                    </div>\n                </div>\n            '),e.length?e.css("position","relative").append(this.adContainer):t(this.player).parent().css("position","relative").append(this.adContainer),t("#flash-ad-close").on("click",()=>{this.hideAd()})},setupEventListeners:function(){t(document).on("pjax:send",()=>{this.destroy()}),t(this.player).on("loadeddata",()=>{this.isPlaying=!0,this.scheduleInterstitialAd()}),t(this.player).on("loadedmetadata",()=>{this.isPlaying=!0}),t(this.player).on("click mousedown mouseup keydown",()=>{this.isPlaying||(this.isPlaying=!0)}),t(window).on("focus",()=>{this.player&&this.player.readyState>=1&&(this.isPlaying=!0)}),t(window).on("blur",()=>{this.isPlaying=!1}),window.triggerFlashInterstitial=()=>{this.showInterstitialAd()}},showPrerollAd:async function(){try{const t=await this.fetchAd("flash-preroll");t&&this.displayAd(t,5e3)}catch(t){}},showInterstitialAd:async function(){const t=Date.now();if(!(t-this.lastAdTime<this.adCooldown)&&this.isPlaying)try{const e=await this.fetchAd("flash-interstitial");e&&(this.lastAdTime=t,this.displayAd(e,8e3))}catch(t){}},fetchAd:async function(e){const i=await t.ajax({url:`/requests/banner-ad?width=400&height=300&placement=${e}`,method:"GET",dataType:"json"});return 200===i.status&&i.data&&i.data.ad_code?i.data:null},displayAd:function(e,i=5e3){this.player&&"function"==typeof this.player.suspend?this.player.suspend():this.player&&"function"==typeof this.player.pause&&this.player.pause(),t("#flash-ad-content").html(`\n                <button id="flash-ad-close" class="\n                    absolute top-2 right-2 w-8 h-8\n                    bg-gray-900 dark:bg-gray-700 hover:bg-red-600 dark:hover:bg-red-500 \n                    text-white border-2 border-white dark:border-gray-300 \n                    rounded-full cursor-pointer text-sm leading-none z-10\n                    flex items-center justify-center\n                    transition-all duration-200 hover:scale-110\n                    shadow-lg hover:shadow-xl\n                ">&times;</button>\n                <div class="ad-content-wrapper max-w-full max-h-full flex items-center justify-center text-gray-900 dark:text-gray-100">\n                    ${e.ad_code}\n                </div>\n            `),t("#flash-ad-content").find("img").css({"max-width":"none","max-height":"none",width:"auto",height:"auto","object-fit":"none"}),t("#flash-ad-content").find("iframe, video, embed, object").css({"max-width":"100%","max-height":"100%",width:"auto",height:"auto","object-fit":"contain"}),this.adContainer.removeClass("hidden").addClass("flex"),setTimeout(()=>{t("#flash-ad-content").removeClass("scale-95").addClass("scale-100")},50);const a=setTimeout(()=>{this.hideAd()},i);t("#flash-ad-close").off("click").on("click",()=>{clearTimeout(a),this.hideAd()})},hideAd:function(){t("#flash-ad-content").removeClass("scale-100").addClass("scale-95"),setTimeout(()=>{this.adContainer.removeClass("flex").addClass("hidden"),this.player&&"function"==typeof this.player.resume?this.player.resume():this.player&&"function"==typeof this.player.play&&this.isPlaying&&this.player.play()},300)},scheduleInterstitialAd:function(){[6e4,18e4,3e5].forEach(t=>{const e=setTimeout(()=>{this.isPlaying&&this.player&&this.showInterstitialAd()},t);this.timers||(this.timers=[]),this.timers.push(e)});const t=setTimeout(()=>{const t=setInterval(()=>{this.isPlaying&&this.player?this.showInterstitialAd():this.player||clearInterval(t)},24e4);this.recurringInterval=t},12e4);this.timers||(this.timers=[]),this.timers.push(t)},destroy:function(){this.timers&&(this.timers.forEach(t=>clearTimeout(t)),this.timers=[]),this.recurringInterval&&(clearInterval(this.recurringInterval),this.recurringInterval=null),this.adContainer&&this.adContainer.remove(),this.player=null,this.adContainer=null,this.isPlaying=!1}},window.showFlashInterstitial=function(){window.FlashAdManager&&"function"==typeof window.FlashAdManager.showInterstitialAd&&window.FlashAdManager.showInterstitialAd()}}(jQuery);