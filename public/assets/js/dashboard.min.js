!function(e){"use strict";function t(){e("#sidebarToggleBtn").on("click",function(){n()}),e("#sidebarCloseBtn").on("click",function(){a()}),e("#sidebarOverlay").on("click",function(){a()}),e(document).on("toggle-sidebar",function(){n()})}function n(){const t=e("#sidebar");e("#sidebarOverlay"),e("#sidebarCloseBtn");t.hasClass("-translate-x-full")?o():a()}function o(){const t=e("#sidebar"),n=e("#sidebarOverlay"),o=e("#sidebarCloseBtn");t.removeClass("-translate-x-full").addClass("translate-x-0"),n.fadeIn(200),o.fadeIn(200),e("body").addClass("sidebar-open")}function a(){const t=e("#sidebar"),n=e("#sidebarOverlay"),o=e("#sidebarCloseBtn");t.removeClass("translate-x-0").addClass("-translate-x-full"),n.fadeOut(200),o.fadeOut(200),e("body").removeClass("sidebar-open")}function s(){e("#userDropdownBtn").on("click",function(t){t.stopPropagation(),e("#userDropdown").slideToggle(200)}),e("#mobileUserDropdownBtn").on("click",function(t){t.stopPropagation(),e("#mobileUserDropdown").slideToggle(200)}),e(document).on("click",function(t){e(t.target).closest("[system-usernav]").length||e("#userDropdown, #mobileUserDropdown").slideUp(200)})}function i(){const t=e("#languageDropdownBtn"),n=e("#languageDropdown");t.on("click",function(e){e.stopPropagation(),n.toggleClass("hidden"),n.hasClass("hidden")||l(n)}),e(document).on("click",function(t){e(t.target).closest("#languageSwitcher").length||n.addClass("hidden")}),t.on("keydown",function(e){!function(e,t){"Enter"===e.key||" "===e.key?(e.preventDefault(),t.toggleClass("hidden"),t.hasClass("hidden")||(l(t),t.find('button[role="menuitem"]').first().focus())):"Escape"===e.key&&(e.preventDefault(),t.addClass("hidden"))}(e,n)})}function l(e){const t=e.find("button.bg-blue-50");if(t.length){const n=e.find(".overflow-y-auto")[0];if(n){const e=t[0].offsetTop,o=t[0].offsetHeight,a=n.clientHeight,s=n.scrollTop;(e<s||e+o>s+a)&&(n.scrollTop=e-a/2+o/2)}}}function r(){e("#clearCacheBtn").on("click",function(t){t.preventDefault();e(this);iziToast.question({title:__("dashboard.cache.clear_title"),message:__("dashboard.cache.clear_message"),titleLineHeight:"25px",backgroundColor:"#FE9431",position:"center",icon:!1,drag:!1,timeout:!1,close:!1,overlay:!0,layout:1,zindex:1024,buttons:[[`<button style="color: white !important;">${__("notifications.confirm")}</button>`,function(t,n){t.hide({transitionOut:"fadeOut"},n,"button"),e.ajax({url:"/requests/clear-cache",method:"POST",dataType:"json"}).done(function(e){const t=system._parseResponse(e);200===t.status?alert.success(t.message):alert.danger(t.message)}).fail(function(e,t,n){alert.danger(__("notifications.cache_clear_error"))})},!0],[`<button style="color: white !important;">${__("notifications.cancel")}</button>`,function(e,t){e.hide({transitionOut:"fadeOut"},t,"button")}]]})})}function d(){e(document).on("change",'select[name="game_type"]',function(){const e=document.getElementById("file-upload-section"),t=document.getElementById("rom-file-upload-section"),n=document.getElementById("rom-system-section"),o=document.getElementById("embed-url-section"),a=document.getElementById("api-enabled-section"),s=document.querySelectorAll('input[name="game_file"]'),i=document.querySelector('input[name="embed_url"]'),l=document.querySelector('select[name="rom_system"]');if(e&&o)if(e&&(e.style.display="none"),t&&(t.style.display="none"),n&&(n.style.display="none"),o&&(o.style.display="none"),s.forEach(e=>{e.required=!1,e.disabled=!0}),"embed"===this.value)o.style.display="block",a&&(a.style.display="block"),i&&(i.required=!0),l&&(l.required=!1);else if("rom"===this.value){t&&(t.style.display="block"),n&&(n.style.display="block"),a&&(a.style.display="none");const e=t.querySelector('input[name="game_file"]');if(e){const t=e.closest("form").querySelector('input[name="title"]')?.value;e.required=!t,e.disabled=!1}i&&(i.required=!1),l&&(l.required=!0)}else{e.style.display="block",a&&(a.style.display="flash"===this.value||"rom"===this.value?"none":"block");const t=e.querySelector('input[name="game_file"]');if(t){const e=t.closest("form").querySelector('input[name="title"]')?.value;t.required=!e,t.disabled=!1}i&&(i.required=!1),l&&(l.required=!1)}}),e(document).on("system:modal:opened",function(t,n){const o=e(n.modalContent).find('select[name="game_type"]'),a=e(n.modalContent).find("#api-enabled-section"),s=e(n.modalContent).find("#rom-system-section"),i=e(n.modalContent).find("#rom-file-upload-section");if(o.length){const e=o.val();a.length&&a.css("display","flash"===e||"rom"===e?"none":"block"),s.length&&s.css("display","rom"===e?"block":"none"),i.length&&i.css("display","rom"===e?"block":"none"),o.trigger("change")}})}function c(t,n,o=__("forms.search")){const a=e('<div class="relative"></div>'),s=e(`<input type="text" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md placeholder-gray-400 transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg" placeholder="${o}">`),i=e('<div class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto hidden"></div>'),l=[];if(t.find("option").each(function(){const t=e(this);l.push({value:t.val(),text:t.text(),selected:t.prop("selected")})}),t.hide(),t.wrap(a),t.after(i),t.after(s),n){const e=l.find(e=>e.value===n);e&&s.val(e.text)}s.on("input focus",function(){!function(n=""){i.empty();const o=l.filter(e=>e.text.toLowerCase().includes(n.toLowerCase())||e.value.toLowerCase().includes(n.toLowerCase()));if(0===o.length){const e=t.hasClass("system-timezone-select")?__("forms.no_timezones_found"):__("forms.no_countries_found");i.append(`<div class="px-4 py-2 text-gray-500">${e}</div>`)}else o.forEach(t=>{if(""===t.value)return;const n=e(`<div class="px-4 py-2 cursor-pointer hover:bg-blue-50 hover:text-blue-700 transition-colors duration-200" data-value="${t.value}">${t.text}</div>`);i.append(n)});i.show()}(e(this).val())}),i.on("click","[data-value]",function(){const n=e(this).data("value"),o=e(this).text();s.val(o),t.val(n).trigger("change"),i.hide()}),s.on("blur",function(){setTimeout(()=>i.hide(),200)}),e(document).on("click",function(t){e(t.target).closest(s.parent()).length||i.hide()})}function u(){e(document).on("system:modal:opened",function(t,n){const o=n.modalContent.find('input[type="color"][name="color"]'),a=n.modalContent.find('input[type="text"]#colorInput'),s=n.modalContent.find(".preset-color"),i=n.modalContent.find("#heroicons-picker-container"),l=n.modalContent.find("#iconInput");if(i.length&&l.length){const r=new HeroIconsPicker({inputSelector:"#iconInput",containerSelector:"#heroicons-picker-container",onSelect:function(e){}}),d=l.val();d&&r.setValue(d)}if(o.length&&a.length){function c(e){s.removeClass("ring-4 ring-blue-400"),s.filter(`[data-color="${e}"]`).addClass("ring-4 ring-blue-400")}c(o.val()),s.on("click",function(t){t.preventDefault(),t.stopPropagation();const n=e(this).data("color");o.val(n),a.val(n),c(n)}),o.on("input",function(){a.val(this.value),c(this.value)}),a.on("input",function(){const e=this.value;/^#[0-9A-F]{6}$/i.test(e)&&(o.val(e),c(e))})}})}function m(){e(document).on("system:modal:opened",function(e,t){t.modalContent.find("#page-content-editor").length>0&&p("#page-content-editor"),t.modalContent.find("#page-content-editor-update").length>0&&p("#page-content-editor-update")}),e(document).on("hidden.bs.modal",function(){window.pageEditors={}})}function p(t){window.pageEditors||(window.pageEditors={});const n=t.replace("#",""),o=document.getElementById(n);if(!o)return;const a=document.createElement("div");a.id=n+"-quill",a.style.height="300px",o.style.display="none",o.parentNode.insertBefore(a,o.nextSibling);const s=new Quill("#"+n+"-quill",{theme:"snow",modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link","image"],["clean"]]},placeholder:__("forms.page_content_placeholder")});o.value&&s.setContents(s.clipboard.convert(o.value)),s.on("text-change",function(){o.value=s.root.innerHTML}),e(o).closest("form").on("submit",function(){o.value=s.root.innerHTML}),window.pageEditors[n]=s}function f(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999);try{document.execCommand("copy"),alert.success(__("notifications.page_link_copied"))}catch(t){alert.error(__("notifications.copy_failed")+": "+e)}document.body.removeChild(t)}function g(t){const n=t.find("#tagInput"),o=t.find("#tagsContainer"),a=t.find("#tagsHiddenInput");if(!n.length||!o.length||!a.length)return;let s=[];const i=a.val();function l(){const e=n.val().trim();e&&!s.includes(e)&&(s.push(e),n.val(""),d(),c())}function r(e){s.splice(e,1),d(),c()}function d(){o.empty(),s.forEach((t,n)=>{const a=e(`\n                    <div class="inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium animate-fadeIn">\n                        <span>${function(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}(t)}</span>\n                        <button type="button" class="ml-1 text-blue-600 hover:text-blue-800 focus:outline-none focus:text-blue-800 transition-colors duration-200" data-tag-index="${n}">\n                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n                            </svg>\n                        </button>\n                    </div>\n                `);o.append(a)}),s.length>0?o.removeClass("empty:hidden").show():o.addClass("empty:hidden").hide()}function c(){a.val(s.join(", "))}i&&(s=i.split(",").map(e=>e.trim()).filter(e=>e),d()),n.on("keydown",function(t){"Enter"===t.key||" "===t.key?(t.preventDefault(),l()):"Backspace"===t.key&&""===e(this).val()&&s.length>0&&r(s.length-1)}),n.on("blur",function(){e(this).val().trim()&&l()}),o.on("click","[data-tag-index]",function(t){t.preventDefault();r(parseInt(e(this).data("tag-index")))})}function h(){e(document).on("system:modal:opened",function(t,n){var o;n.modalContent.find(".cronRunBtn").length>0&&(o=n.modalContent).find(".cronRunBtn").each(function(){const t=e(this);t.on("click",function(n){n.preventDefault();const a=t.data("job"),s=t.text();t.prop("disabled",!0),t.text(__("dashboard.cron.running")),t.addClass("opacity-50");const i=o.find("[data-cron-password]").data("cron-password")||"";e.ajax({url:`/cronjobs/${a}`,method:"GET",data:{password:i},dataType:"json"}).done(function(e){200===e.status?(t.text(__("notifications.success")),t.removeClass("bg-green-600 hover:bg-green-700"),t.addClass("bg-green-500"),setTimeout(()=>{t.text(s),t.addClass("bg-green-600 hover:bg-green-700"),t.removeClass("bg-green-500 opacity-50"),t.prop("disabled",!1)},3e3),alert.success(e.message)):alert.danger(e.message)}).fail(function(e,n,o){t.text(__("dashboard.cron.failed")),t.removeClass("bg-green-600 hover:bg-green-700"),t.addClass("bg-red-500");let a=__("dashboard.cron.failed_message");e.responseJSON&&e.responseJSON.message?a=e.responseJSON.message:o&&(a=o),setTimeout(()=>{t.text(s),t.addClass("bg-green-600 hover:bg-green-700"),t.removeClass("bg-red-500 opacity-50"),t.prop("disabled",!1)},3e3),alert.danger(a)})})})})}function b(e,t){e.prop("disabled",!1),e.removeClass("opacity-75 cursor-not-allowed"),e.addClass("hover:shadow-xl hover:scale-105"),e.html(t)}function y(){e("#rebuildAssetsBtn").on("click",function(t){t.preventDefault(),iziToast.question({title:__("dashboard.template_manager.rebuild_assets"),message:__("dashboard.template_manager.rebuild_confirm"),titleLineHeight:"25px",backgroundColor:"#FB923C",position:"center",icon:!1,drag:!1,timeout:!1,close:!1,overlay:!0,layout:1,zindex:1024,buttons:[[`<button style="color: white !important;">${__("notifications.confirm")}</button>`,function(t,n){t.hide({transitionOut:"fadeOut"},n,"button"),system.loader(__("dashboard.template_manager.rebuilding_assets")),e.ajax({url:"/requests/rebuild-assets",method:"POST",dataType:"json"}).done(function(e){system.loader(!1,!1);const t=system._parseResponse(e);200===t.status?alert.success(t.message):alert.danger(t.message)}).fail(function(e,t,n){system.loader(!1,!1);let o=__("dashboard.template_manager.rebuild_failed");e.responseJSON&&e.responseJSON.message&&(o=e.responseJSON.message),alert.danger(o)})},!0],[`<button style="color: white !important;">${__("notifications.cancel")}</button>`,function(e,t){e.hide({transitionOut:"fadeOut"},t,"button")}]]})})}e(function(){t(),s(),i(),r(),d(),alert.setup(),system.modals(),system.delete(),system.actions(),window.pjax=new Pjax({scrollTo:!1,cacheBust:!1,elements:"[system-nav]",selectors:["title","[system-navbar]","[system-usernav]","[system-wrapper]"]}),e(document).on("pjax:send",function(){window.table&&(table.destroyTable(),window.table=null),a(),e("body").removeClass("sidebar-open"),topbar.show()}),e(document).on("pjax:complete",function(){e("body").removeClass("sidebar-open"),system.tables(),topbar.hide(),s(),t(),i(),r(),y()}),e(document).on("system:modal:opened",function(t,n){!function(t){const n=t.find(".system-country-select");0!==n.length&&n.each(function(){const t=e(this),n=t.val();c(t,n,__("forms.search_countries"))})}(n.modalContent),function(t){const n=t.find(".system-timezone-select");0!==n.length&&n.each(function(){const t=e(this),n=t.val();c(t,n,__("forms.search_timezones"))})}(n.modalContent),g(n.modalContent)}),h(),e(document).on("click",".activate-template-btn",function(t){t.preventDefault();const n=e(this),o=n.data("template-id");o?function(t,n){const o=n.html(),a=n.find("span");a.text(),n.prop("disabled",!0),n.removeClass("hover:shadow-xl hover:scale-105"),n.addClass("opacity-75 cursor-not-allowed"),a.text(__("dashboard.template_manager.activating")),e.ajax({url:"/requests/activate-template",method:"POST",data:{template_id:t},dataType:"json"}).done(function(e){const t=system._parseResponse(e);200===t.status?(pjax.loadUrl("/dashboard/templates"),alert.success(t.message)):(b(n,o),alert.danger(t.message))}).fail(function(e,t,a){b(n,o);let s=__("dashboard.template_manager.activation_failed");e.responseJSON&&e.responseJSON.message&&(s=e.responseJSON.message),alert.danger(s)})}(o,n):alert.danger(__("dashboard.template_manager.template_id_not_found"))}),e(document).on("click",'[template-delete^="templates/"]',function(t){t.preventDefault();const n=e(this).attr("template-delete").replace("templates/","");n?function(t){iziToast.question({title:__("dashboard.template_manager.delete_template"),message:__("dashboard.template_manager.delete_template_confirm",{template:t}),titleLineHeight:"25px",backgroundColor:"#E82753",position:"center",icon:!1,drag:!1,timeout:!1,close:!1,overlay:!0,layout:1,zindex:1024,buttons:[['<button style="color: white !important;">'+__("notifications.confirm")+"</button>",function(n,o){!function(t,n,o){n.hide({transitionOut:"fadeOut"},o,"button"),system.loader(__("notifications.processing_request")),e.ajax({url:`/requests/delete-template/${t}`,type:"GET",success:function(e){system.loader(!1,!1),function(e){switch(e.status){case 200:pjax.loadUrl("/dashboard/templates"),alert.success(e.message);break;case 302:alert.warning(__("notifications.session_expired"),!0);break;default:alert.danger(e.message)}}(system._parseResponse(e))},error:function(){system.loader(!1,!1),alert.danger(__("notifications.error"))}})}(t,n,o)},!0],['<button style="color: white !important;">'+__("notifications.cancel")+"</button>",function(e,t){e.hide({transitionOut:"fadeOut"},t,"button")}]]})}(n):alert.danger(__("dashboard.template_manager.template_id_not_found"))}),y(),e("[system-preloader]").fadeOut("fast",function(){system.tables()}),u(),m()}),window.changeLanguage=function(t){const n=e("#languageDropdownBtn");n.html();n.prop("disabled",!0).html(`\n            <svg class="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>\n            </svg>\n            <span class="hidden sm:inline text-sm font-medium text-gray-700">${__("api.languages.changing")}</span>\n        `),e.post("/languages/change",{language:t}).done(function(e){200===e.status?alert.success(e.message||__("notifications.success"),!0):(alert.danger(e.message||__("notifications.error")),n.find("span").text(originalText))}).fail(function(e){let t=__("notifications.network_error");try{t=JSON.parse(e.responseText).message||t}catch(e){}alert.danger(t),n.find("span").text(originalText)})},window.copyPageLink=function(e){const t=window.location.origin+"/page/"+e;navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(t).then(function(){alert.success(__("notifications.link_copied"))}).catch(function(){f(t)}):f(t)},window.dashboardUtils={toggleSidebar:n,openSidebar:o,closeSidebar:a,initGameFormHandlers:d,initCategoryFormHandlers:u,initPageFormHandlers:m,initTagsInput:g,initCronGuide:h}}(jQuery);