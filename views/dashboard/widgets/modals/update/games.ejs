<div class="p-6">
    <div class="flex items-start justify-between">
        <h3 class="text-lg font-semibold text-gray-900">
            <svg class="w-6 h-6 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v4a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm2 3V5h2v2H5zm8 0V5h2v2h-2z" clip-rule="evenodd"/><path d="M3 8.5a1 1 0 011-1h1a1 1 0 011 1v3a1 1 0 01-1 1H4a1 1 0 01-1-1v-3zm8 0a1 1 0 011-1h1a1 1 0 011 1v3a1 1 0 01-1 1h-1a1 1 0 01-1-1v-3z"/></svg><%= title %>
        </h3>

        <button type="button" class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
    </div>

    <form system-form class="mt-4 space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.game_title') %></label>
                <input type="text" name="title" required value="<%= data.game.title %>" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md placeholder-gray-400 transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg" placeholder="<%= __('dashboard.widgets.update.games.game_title_placeholder') %>">
            </div>

            <div>
                <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.slug') %> <span class="text-gray-500 text-xs">(<%= __('dashboard.widgets.update.games.optional') %>)</span></label>
                <input type="text" name="slug" value="<%= data.game.slug %>" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md placeholder-gray-400 transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg" placeholder="<%= __('dashboard.widgets.update.games.slug_placeholder') %>">
                <p class="mt-1 text-xs text-gray-500"><%= __('dashboard.widgets.update.games.slug_help') %></p>
            </div>
        </div>

        <div>
            <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.short_description') %></label>
            <input type="text" name="short_description" maxlength="500" value="<%= data.game.short_description || '' %>" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md placeholder-gray-400 transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg" placeholder="<%= __('dashboard.widgets.update.games.short_description_placeholder') %>">
        </div>

        <div>
            <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.description') %></label>
            <textarea name="description" rows="4" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md placeholder-gray-400 transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg" placeholder="<%= __('dashboard.widgets.update.games.description_placeholder') %>"><%= data.game.description || '' %></textarea>
        </div>

        <div>
            <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.game_image') %></label>
            <input type="file" name="game_image" accept=".jpg,.jpeg,.png,.gif" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg">
            <% if (data.game.thumbnail) { %>
                <div class="mt-2">
                    <% 
                    let thumbnailUrl = data.game.thumbnail;
                    
                    // Check if it's the new JSON format with parsedThumbnail
                    if (data.game.parsedThumbnail && data.game.parsedThumbnail.webp && data.game.parsedThumbnail.original) {
                        let webpImage = data.game.parsedThumbnail.webp.thumbnail || data.game.parsedThumbnail.webp.standard;
                        let originalImage = data.game.parsedThumbnail.original.thumbnail || data.game.parsedThumbnail.original.standard;
                        
                        if (webpImage && originalImage) { %>
                            <picture>
                                <source srcset="/<%= webpImage.relativePath %>" type="image/webp">
                                <img src="/<%= originalImage.relativePath %>" alt="Current thumbnail" class="h-20 w-32 object-cover rounded-lg border">
                            </picture>
                        <% } else {
                            thumbnailUrl = data.game.thumbnail.startsWith('/') ? data.game.thumbnail : '/' + data.game.thumbnail; %>
                            <img src="<%= thumbnailUrl %>" alt="Current thumbnail" class="h-20 w-32 object-cover rounded-lg border">
                        <% }
                    } else {
                        // Handle old format or JSON string format
                        try {
                            if (typeof data.game.thumbnail === 'string' && data.game.thumbnail.startsWith('{')) {
                                let parsedData = JSON.parse(data.game.thumbnail);
                                if (parsedData.webp && parsedData.webp.thumbnail) {
                                    thumbnailUrl = `/${parsedData.webp.thumbnail.relativePath}`;
                                } else if (parsedData.original && parsedData.original.thumbnail) {
                                    thumbnailUrl = `/${parsedData.original.thumbnail.relativePath}`;
                                } else {
                                    thumbnailUrl = data.game.thumbnail.startsWith('/') ? data.game.thumbnail : '/' + data.game.thumbnail;
                                }
                            } else {
                                thumbnailUrl = data.game.thumbnail.startsWith('/') ? data.game.thumbnail : '/' + data.game.thumbnail;
                            }
                        } catch(e) {
                            thumbnailUrl = data.game.thumbnail.startsWith('/') ? data.game.thumbnail : '/' + data.game.thumbnail;
                        } %>
                        <img src="<%= thumbnailUrl %>" alt="Current thumbnail" class="h-20 w-32 object-cover rounded-lg border">
                    <% } %>
                    <p class="mt-1 text-xs text-gray-500"><%= __('dashboard.widgets.update.games.current_image_help') %></p>
                </div>
            <% } else { %>
                <p class="mt-1 text-xs text-gray-500"><%= __('dashboard.widgets.update.games.supported_formats_help') %></p>
            <% } %>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.category') %></label>
                <select name="category_id" required class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg">
                    <option value=""><%= __('dashboard.widgets.update.games.select_category') %></option>
                    <% if (data.categories && data.categories.length > 0) { %>
                        <% data.categories.forEach(category => { %>
                            <option value="<%= category.id %>" <%= data.game.category_id == category.id ? 'selected' : '' %>><%= category.name %></option>
                        <% }); %>
                    <% } %>
                </select>
            </div>

            <div>
                <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.game_type') %></label>
                <select name="game_type" required class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg">
                    <option value="html" <%= data.game.game_type === 'html' ? 'selected' : '' %>>HTML5</option>
                    <option value="flash" <%= data.game.game_type === 'flash' ? 'selected' : '' %>>Flash (SWF)</option>
                    <option value="rom" <%= data.game.game_type === 'rom' ? 'selected' : '' %>>ROM</option>
                    <option value="embed" <%= data.game.game_type === 'embed' ? 'selected' : '' %>>Embed URL</option>
                </select>
            </div>
        </div>

        <div id="rom-system-section" style="<%= data.game.game_type !== 'rom' ? 'display: none;' : '' %>">
            <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.rom_system') %></label>
            <select name="rom_system" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg">
                <option value="automatic" <%= (data.game.rom_system === 'automatic' || !data.game.rom_system) ? 'selected' : '' %>><%= __('dashboard.widgets.update.games.automatic_detection') %></option>
                <optgroup label="Nintendo">
                    <option value="nes" <%= data.game.rom_system === 'nes' ? 'selected' : '' %>>NES (Nintendo Entertainment System)</option>
                    <option value="snes" <%= data.game.rom_system === 'snes' ? 'selected' : '' %>>SNES (Super Nintendo)</option>
                    <option value="gb" <%= data.game.rom_system === 'gb' ? 'selected' : '' %>>GB/GBC (Game Boy/Game Boy Color)</option>
                    <option value="gba" <%= data.game.rom_system === 'gba' ? 'selected' : '' %>>GBA (Game Boy Advance)</option>
                    <option value="n64" <%= data.game.rom_system === 'n64' ? 'selected' : '' %>>N64 (Nintendo 64)</option>
                    <option value="nds" <%= data.game.rom_system === 'nds' ? 'selected' : '' %>>NDS (Nintendo DS)</option>
                    <option value="vb" <%= data.game.rom_system === 'vb' ? 'selected' : '' %>>VB (Virtual Boy)</option>
                </optgroup>
                <optgroup label="Sega">
                    <option value="genesis" <%= data.game.rom_system === 'genesis' ? 'selected' : '' %>>Genesis/Mega Drive</option>
                    <option value="segaMS" <%= data.game.rom_system === 'segaMS' ? 'selected' : '' %>>Master System</option>
                    <option value="segaGG" <%= data.game.rom_system === 'segaGG' ? 'selected' : '' %>>Game Gear</option>
                    <option value="sega32x" <%= data.game.rom_system === 'sega32x' ? 'selected' : '' %>>32X</option>
                    <option value="segaCD" <%= data.game.rom_system === 'segaCD' ? 'selected' : '' %>>Sega CD</option>
                    <option value="segaSaturn" <%= data.game.rom_system === 'segaSaturn' ? 'selected' : '' %>>Saturn</option>
                </optgroup>
                <optgroup label="Sony">
                    <option value="psx" <%= data.game.rom_system === 'psx' ? 'selected' : '' %>>PSX (PlayStation 1)</option>
                    <option value="psp" <%= data.game.rom_system === 'psp' ? 'selected' : '' %>>PSP (PlayStation Portable)</option>
                </optgroup>
                <optgroup label="Atari">
                    <option value="atari2600" <%= data.game.rom_system === 'atari2600' ? 'selected' : '' %>>Atari 2600</option>
                    <option value="atari7800" <%= data.game.rom_system === 'atari7800' ? 'selected' : '' %>>Atari 7800</option>
                    <option value="a5200" <%= data.game.rom_system === 'a5200' ? 'selected' : '' %>>Atari 5200</option>
                    <option value="lynx" <%= data.game.rom_system === 'lynx' ? 'selected' : '' %>>Atari Lynx</option>
                    <option value="jaguar" <%= data.game.rom_system === 'jaguar' ? 'selected' : '' %>>Atari Jaguar</option>
                </optgroup>
                <optgroup label="Other">
                    <option value="pce" <%= data.game.rom_system === 'pce' ? 'selected' : '' %>>PCE (PC Engine/TurboGrafx-16)</option>
                    <option value="3do" <%= data.game.rom_system === '3do' ? 'selected' : '' %>>3DO</option>
                    <option value="c64" <%= data.game.rom_system === 'c64' ? 'selected' : '' %>>Commodore 64</option>
                    <option value="amiga" <%= data.game.rom_system === 'amiga' ? 'selected' : '' %>>Amiga</option>
                    <option value="coleco" <%= data.game.rom_system === 'coleco' ? 'selected' : '' %>>ColecoVision</option>
                    <option value="ngp" <%= data.game.rom_system === 'ngp' ? 'selected' : '' %>>Neo Geo Pocket</option>
                    <option value="ws" <%= data.game.rom_system === 'ws' ? 'selected' : '' %>>WonderSwan</option>
                    <option value="arcade" <%= data.game.rom_system === 'arcade' ? 'selected' : '' %>>Arcade (MAME)</option>
                </optgroup>
            </select>
        </div>

        <div id="file-upload-section" style="<%= (data.game.game_type === 'embed' || data.game.game_type === 'rom') ? 'display: none;' : '' %>">
            <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.game_file') %></label>
            <input type="file" name="game_file" accept=".html,.swf,.zip" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg" <%= (data.game.game_type === 'embed' || data.game.game_type === 'rom') ? 'disabled' : '' %>>
            <% if (data.game.game_file) { %>
            <small class="text-gray-500"><%= __('dashboard.widgets.update.games.current_file') %>: <%= data.game.game_file %></small>
            <% } %>
        </div>

        <div id="rom-file-upload-section" style="<%= data.game.game_type !== 'rom' ? 'display: none;' : '' %>">
            <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.rom_file') %></label>
            <input type="file" name="game_file" accept=".nes,.snes,.sfc,.smc,.gba,.gb,.gbc,.md,.gen,.smd,.n64,.z64,.v64,.bin,.cue,.iso,.pce,.zip" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg" <%= data.game.game_type !== 'rom' ? 'disabled' : '' %>>
            <% if (data.game.game_file && data.game.game_type === 'rom') { %>
            <small class="text-gray-500"><%= __('dashboard.widgets.update.games.current_rom_file') %>: <%= data.game.game_file %></small>
            <% } %>
            <small class="text-gray-500 text-xs"><%= __('dashboard.widgets.update.games.rom_supported_formats') %></small>
        </div>

        <div id="embed-url-section" style="<%= data.game.game_type !== 'embed' ? 'display: none;' : '' %>">
            <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.embed_url') %></label>
            <input type="url" name="embed_url" value="<%= data.game.embed_url || '' %>" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md placeholder-gray-400 transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg" placeholder="https://example.com/game">
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.width') %></label>
                <input type="number" name="width" value="<%= data.game.width || 800 %>" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md placeholder-gray-400 transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg">
            </div>

            <div>
                <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.height') %></label>
                <input type="number" name="height" value="<%= data.game.height || 600 %>" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md placeholder-gray-400 transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg">
            </div>
        </div>

        <div>
            <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.game_controls') %></label>
            <textarea name="controls" rows="2" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md placeholder-gray-400 transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg" placeholder="<%= __('dashboard.widgets.update.games.game_controls_placeholder') %>"><%= data.game.controls || '' %></textarea>
        </div>

        <div>
            <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.tags') %></label>
            <div class="tags-input-container">
                <input type="hidden" name="tags" id="tagsHiddenInput" value="<%= data.game.tags || '' %>" />
                <div id="tagsContainer" class="flex flex-wrap gap-2 mb-2 min-h-[2rem] empty:hidden"></div>
                <input type="text" id="tagInput" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md placeholder-gray-400 transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg" placeholder="<%= __('dashboard.widgets.update.games.tags_placeholder') %>">
            </div>
            <p class="mt-1 text-xs text-gray-500"><%= __('dashboard.widgets.update.games.tags_help') %></p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.featured') %></label>
                <select name="is_featured" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg">
                    <option value="0" <%= !data.game.is_featured ? 'selected' : '' %>><%= __('dashboard.widgets.update.games.normal_option') %></option>
                    <option value="1" <%= data.game.is_featured ? 'selected' : '' %>><%= __('dashboard.widgets.update.games.featured_option') %></option>
                </select>
            </div>

            <div>
                <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.active') %></label>
                <select name="is_active" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg">
                    <option value="1" <%= data.game.is_active ? 'selected' : '' %>><%= __('dashboard.widgets.update.games.active_option') %></option>
                    <option value="0" <%= !data.game.is_active ? 'selected' : '' %>><%= __('dashboard.widgets.update.games.inactive_option') %></option>
                </select>
            </div>

            <div id="api-enabled-section" style="<%= (data.game.game_type === 'flash' || data.game.game_type === 'rom') ? 'display: none;' : '' %>">
                <label class="mb-1 block text-sm font-medium text-gray-700"><%= __('dashboard.widgets.update.games.api_integration') %></label>
                <select name="api_enabled" class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-700 shadow-md transition-all duration-200 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:shadow-lg">
                    <option value="0" <%= !data.game.api_enabled ? 'selected' : '' %>><%= __('dashboard.widgets.update.games.disabled_option') %></option>
                    <option value="1" <%= data.game.api_enabled ? 'selected' : '' %>><%= __('dashboard.widgets.update.games.enabled_option') %></option>
                </select>
            </div>
        </div>

        <div class="mt-6 text-right">
            <button type="submit" class="inline-flex items-center gap-1 sm:gap-2 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium text-white shadow-xl transition-all duration-200 hover:from-blue-700 hover:to-indigo-700 hover:shadow-2xl hover:-translate-y-1">
                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><%= __('dashboard.widgets.update.games.submit_button') %>
            </button>
        </div>
    </form>
</div>

